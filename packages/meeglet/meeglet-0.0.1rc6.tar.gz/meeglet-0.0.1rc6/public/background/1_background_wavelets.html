<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Denis Engemann">
<meta name="author" content="Joseph Paillard">
<meta name="author" content="JÃ¶rg Hipp">

<title>neuro-meeglet - Mathematical Deep Dive</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="neuro-meeglet - Mathematical Deep Dive">
<meta property="og:description" content="Morlet Wavelets for M/EEG analysis">
<meta property="og:site_name" content="neuro-meeglet">
<meta name="twitter:title" content="neuro-meeglet - Mathematical Deep Dive">
<meta name="twitter:description" content="Morlet Wavelets for M/EEG analysis">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">neuro-meeglet</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Roche/neuro-meeglet"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../background/index.html">Background</a></li><li class="breadcrumb-item"><a href="../background/1_background_wavelets.html">Mathematical Deep Dive</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MEEGLET</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../background/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/0_tour.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Onboarding</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/1_background_wavelets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Mathematical Deep Dive</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tutorials/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/plot_eeg_covariance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EEG covariance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/plot_eeg_power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EEG power</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/plot_wavelets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Define Wavelets</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../api/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/wavelets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Morlet Wavelets for M/EEG</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../matlab/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MATLAB</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../matlab/matlab_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MATLAB functionality</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background-and-setting" id="toc-background-and-setting" class="nav-link active" data-scroll-target="#background-and-setting">Background and setting</a></li>
  <li><a href="#morlet-wavelet-parameterization" id="toc-morlet-wavelet-parameterization" class="nav-link" data-scroll-target="#morlet-wavelet-parameterization">Morlet wavelet parameterization</a>
  <ul>
  <li><a href="#selection-of-a-grid-of-center-frequencies-for-spectral-analyses" id="toc-selection-of-a-grid-of-center-frequencies-for-spectral-analyses" class="nav-link" data-scroll-target="#selection-of-a-grid-of-center-frequencies-for-spectral-analyses">Selection of a grid of center frequencies for spectral analyses</a></li>
  <li><a href="#relationship-between-the-bandwidth-in-octaves-and-the-characteristic-morlet-wavelet-parameter-q" id="toc-relationship-between-the-bandwidth-in-octaves-and-the-characteristic-morlet-wavelet-parameter-q" class="nav-link" data-scroll-target="#relationship-between-the-bandwidth-in-octaves-and-the-characteristic-morlet-wavelet-parameter-q">Relationship between the bandwidth in octaves and the characteristic Morlet wavelet parameter <span class="math inline">\(q\)</span></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Roche/neuro-meeglet/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../background/index.html">Background</a></li><li class="breadcrumb-item"><a href="../background/1_background_wavelets.html">Mathematical Deep Dive</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Mathematical Deep Dive</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Denis Engemann </p>
             <p>Joseph Paillard </p>
             <p>JÃ¶rg Hipp </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>Definition and parameterization of Morlet wavelets</p>
</blockquote>
<section id="background-and-setting" class="level3">
<h3 class="anchored" data-anchor-id="background-and-setting">Background and setting</h3>
<p>Despite the popularity and extensive use of Morlet wavelets for M/EEG analysis, differences in notation and parameterization used in the literature can be confusing. In the following, we provide visual and formal definitions, introduce our logarithmic parameterization, and establish its link with other parameterizations.</p>
<p>First of all, Morlet wavelets <span class="citation" data-cites="morlet_wave_1982">(<a href="#ref-morlet_wave_1982" role="doc-biblioref">Morlet et al. 1982</a>)</span> extend Gabor wavelets <span class="citation" data-cites="gabor1946theory">(<a href="#ref-gabor1946theory" role="doc-biblioref">Gabor 1946</a>)</span>: Both, Gabor wavelets and Morlet wavelets are obtained by multiplying a complex sine-wave (oscillation) with a Gaussian taper. By construction, following from the uncertainty principle, Gabor and Morlet wavelets will also have a Gaussian shape in the frequency domain (if finite window lengths are neglected). Morlet wavelets define families of Gabor wavelets in which width and frequency are logarithmically scaled <span class="citation" data-cites="morlet_wave_1982 tallon1996stimulus">(<a href="#ref-morlet_wave_1982" role="doc-biblioref">Morlet et al. 1982</a>; <a href="#ref-tallon1996stimulus" role="doc-biblioref">Tallon-Baudry et al. 1996</a>)</span>. This means that a single Morlet wavelet is essentially a Gabor wavelet.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Gabor and Morlet Wavelets
</div>
</div>
<div class="callout-body-container callout-body">
<p>To capture the variations of the spectral content of a signal over time, Gabor introduced in 1946 a basis of elementary waveforms, also known as time-frequency atoms <span class="citation" data-cites="gabor1946theory">(<a href="#ref-gabor1946theory" role="doc-biblioref">Gabor 1946</a>)</span>. Such wavelets provide a localized time-frequency representation of the signal with an optimal tradeoff between time and frequency precision. Later, in 1982, Morlet adapted these wavelets to include a logarithmic scale in octave for the frequency of the sine wave and the width of the Gaussian window <span class="citation" data-cites="morlet_wave_1982">(<a href="#ref-morlet_wave_1982" role="doc-biblioref">Morlet et al. 1982</a>)</span>. This scaling means that with increasing frequency, the wavelet becomes more time-localized (narrower time window) and less frequency-localized in (wider frequency bandwidth). Such wavelets, henceforth referred to as Morlet wavelets, account for log-frequency behavior and can be better suited for electrophysiological signals <span class="citation" data-cites="tallon1996stimulus">(<a href="#ref-tallon1996stimulus" role="doc-biblioref">Tallon-Baudry et al. 1996</a>)</span>.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Essential design choice
</div>
</div>
<div class="callout-body-container callout-body">
<p>A key feature of our parameterization is to express the Gaussian taper in terms of its <em>spectral smoothing</em>, i.e., spectral bandwidth (<span class="math inline">\(bw\)</span>), logarithmically in units of <em>octaves</em> <span class="citation" data-cites="hipp2012large">(<a href="#ref-hipp2012large" role="doc-biblioref">Hipp et al. 2012</a>)</span>.</p>
</div>
</div>
<p>Letâs consider an example of a Morlet wavelet with a center frequency of interest <span class="math inline">\(f=2 Hz\)</span> and a bandwidth of <span class="math inline">\(bw=0.5 oct\)</span>. The example Morlet wavelet is illustrated in <a href="#fig-wavelet" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div id="cell-fig-wavelet" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.transforms <span class="im">as</span> transforms</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># parameter</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sfreq <span class="op">=</span> <span class="fl">1000.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>foi <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>bw <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for arithmetic mean</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>foi_min <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> foi <span class="op">/</span> (<span class="dv">2</span> <span class="op">**</span> bw <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>foi_max <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> foi <span class="op">/</span> (<span class="dv">2</span> <span class="op">**</span> <span class="op">-</span>bw <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> foi_max <span class="op">-</span> foi_min <span class="co"># frequency smoothing / FWHM</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> df <span class="op">/</span> (<span class="dv">2</span><span class="op">*</span>np.sqrt(<span class="dv">2</span><span class="op">*</span>np.log(<span class="dv">2</span>))) <span class="co"># map FWHM to sigma_f</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">/</span> np.pi <span class="op">/</span>sf <span class="co"># sigma t (uncertainty relation)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>kernel_width <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> kernel_width <span class="op">*</span> st</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> np.<span class="bu">round</span>(T <span class="op">*</span> sfreq)  <span class="op">/</span> sfreq</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>n_win <span class="op">=</span> np.<span class="bu">round</span>(T <span class="op">*</span> sfreq)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="op">-</span>n_win <span class="op">/</span> <span class="dv">2</span>, n_win <span class="op">/</span> <span class="dv">2</span>) <span class="op">/</span> sfreq</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> np.arange(<span class="dv">0</span>, n_win) <span class="op">/</span> T</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> time <span class="op">/</span> st</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>gaussian <span class="op">=</span> np.exp(<span class="op">-</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Z <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>gaussian <span class="op">/=</span> np.<span class="bu">sum</span>(gaussian)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>oscillation <span class="op">=</span> np.exp(<span class="ot">1j</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> foi <span class="op">*</span> time)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> (gaussian <span class="op">*</span> oscillation)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#freq = np.arange(0, len(kernel)) / T</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>freq_high_res <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2</span><span class="op">**</span><span class="dv">14</span>) <span class="op">/</span> (<span class="dv">2</span><span class="op">**</span><span class="dv">14</span> <span class="op">/</span> sfreq)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>kernel_fft <span class="op">=</span> np.fft.fft(kernel, <span class="dv">2</span><span class="op">**</span><span class="dv">14</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="fl">7.5</span>, <span class="dv">7</span>))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>ax1.plot(time, kernel.real, <span class="st">'b'</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>ax1.plot(time, kernel.imag,<span class="st">'c'</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>ax1.plot(time, gaussian,<span class="st">'k'</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>ax1.ticklabel_format(axis<span class="op">=</span><span class="st">'y'</span>, style<span class="op">=</span><span class="st">'sci'</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                     scilimits<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), useMathText<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>trans <span class="op">=</span> transforms.blended_transform_factory(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    ax1.transData, ax1.transAxes)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>trans2 <span class="op">=</span> transforms.blended_transform_factory(</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    ax2.transData, ax2.transAxes)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.15</span>, <span class="st">'A'</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>          {<span class="st">'color'</span>: <span class="st">'k'</span>, <span class="st">'fontsize'</span>: <span class="dv">20</span>},</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax1.transAxes)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="fl">0.85</span>, <span class="fl">0.82</span>, <span class="st">'cos'</span>, </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>         {<span class="st">'color'</span>: <span class="st">'b'</span>},</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax1.transAxes)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="fl">0.85</span>, <span class="fl">0.75</span>, <span class="st">'sin'</span>, </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>         {<span class="st">'color'</span>: <span class="st">'c'</span>},</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax1.transAxes)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0.15</span>, </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>         <span class="st">"""</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="st">         Morlet wavelet:</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="st">         center frequency = </span><span class="sc">%.1f</span><span class="st"> Hz</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="st">         band width = </span><span class="sc">%.1f</span><span class="st"> octaves</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="st">         """</span> <span class="op">%</span> (foi,bw),</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax1.transAxes</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>ax1.axvline(<span class="dv">0</span>, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>ax1.axvline(<span class="op">-</span>st, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>ax1.axvline(st, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="fl">0.5</span>, <span class="fl">1.05</span>, <span class="vs">r'$0$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax1.transAxes, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="op">-</span>st, <span class="fl">1.05</span>, <span class="vs">r'$\sigma_t$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>ax1.text(st, <span class="fl">1.05</span>, <span class="vs">r'$\sigma_t$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>ax1.annotate(<span class="st">""</span>, xy<span class="op">=</span>(<span class="op">-</span>kernel_width<span class="op">/</span><span class="dv">2</span><span class="op">*</span>st, <span class="fl">1.15</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>), xytext<span class="op">=</span>(kernel_width<span class="op">/</span><span class="dv">2</span><span class="op">*</span>st, <span class="fl">1.15</span>),</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>             arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"&lt;-&gt;"</span>, connectionstyle<span class="op">=</span><span class="st">"arc3"</span>),</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>             xycoords<span class="op">=</span>trans, textcoords<span class="op">=</span>trans)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="fl">0.5</span>, <span class="fl">1.15</span>, <span class="vs">r'$T$'</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>         {<span class="st">'color'</span>: <span class="st">'black'</span>, <span class="st">'fontsize'</span>: <span class="dv">10</span>, <span class="st">'ha'</span>: <span class="st">'center'</span>, <span class="st">'va'</span>: <span class="st">'center'</span>,</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>          <span class="st">'bbox'</span>: <span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round"</span>, fc<span class="op">=</span><span class="st">"white"</span>, ec<span class="op">=</span><span class="st">"black"</span>, pad<span class="op">=</span><span class="fl">0.2</span>)},</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>         transform<span class="op">=</span>ax1.transAxes</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Time [s]'</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Amplitude [a.u.]'</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="op">-</span>T<span class="op">/</span><span class="dv">2</span>, T<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>ax2.text(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.05</span>, <span class="st">'B'</span>,</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>          {<span class="st">'color'</span>: <span class="st">'k'</span>, <span class="st">'fontsize'</span>: <span class="dv">20</span>},</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax2.transAxes)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> (freq_high_res <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="op">&amp;</span> (freq_high_res <span class="op">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>ax2.plot(freq_high_res[idx], np.<span class="bu">abs</span>(kernel_fft[idx]), color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Frequency [Hz]'</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Amplitude [a.u.]'</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>ax2.axvline(foi, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>ax2.axvline(foi<span class="op">-</span>sf, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>ax2.axvline(foi<span class="op">+</span>sf, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>ax2.text(<span class="fl">0.5</span>, <span class="fl">1.05</span>, <span class="vs">r'$f$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax2.transAxes, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>ax2.text(foi<span class="op">-</span>sf, <span class="fl">1.03</span>, <span class="vs">r'$f-\sigma_f$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans2, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>ax2.text(foi<span class="op">+</span>sf, <span class="fl">1.03</span>, <span class="vs">r'$f+\sigma_f$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans2, color<span class="op">=</span><span class="st">'#ff7f0e'</span>)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>ax2.axvline(foi<span class="op">-</span>df<span class="op">/</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>ax2.axvline(foi<span class="op">+</span>df<span class="op">/</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>ax2.text(foi<span class="op">-</span>df<span class="op">/</span><span class="dv">2</span>, <span class="fl">1.11</span>, <span class="vs">r'$f_</span><span class="sc">{min}</span><span class="vs">$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans2, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>ax2.text(foi<span class="op">+</span>df<span class="op">/</span><span class="dv">2</span>, <span class="fl">1.09</span>, <span class="vs">r'$f_</span><span class="sc">{max}</span><span class="vs">$'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>trans2, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>ax2.text(<span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="st">'Fourier transform</span><span class="ch">\n</span><span class="st">of Morlet wavelet in panel A'</span>,</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>         {<span class="st">'color'</span>: <span class="st">'k'</span>},</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>         horizontalalignment<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>         verticalalignment<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax2.transAxes)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-wavelet" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wavelet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_background_wavelets_files/figure-html/fig-wavelet-output-1.png" width="710" height="660" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wavelet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Example Morlet wavelet in time and frequency domain (a.u., arbitrary units).
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="morlet-wavelet-parameterization" class="level3">
<h3 class="anchored" data-anchor-id="morlet-wavelet-parameterization">Morlet wavelet parameterization</h3>
<p>In our parameterization, we describe Morlet wavelets families by the spectral smoothing, i.e.&nbsp;spectral bandwidth (<span class="math inline">\(bw\)</span>). In the following, we detail, how the Morlet wavelets are derived for center frequencies <span class="math inline">\(f\)</span> .</p>
<p>A bandpass filter, that a Morlet wavelet basically is, is described by the two edge frequencies, <span class="math inline">\(f_{min}\)</span> and <span class="math inline">\(f_{max}\)</span>, where the signal subjected to the filter is attenuated by 50% (see <a href="#fig-wavelet" class="quarto-xref">Figure&nbsp;1</a> panel B). We define the bandwidth of the filter as:</p>
<p><span id="eq-1"><span class="math display">\[
bw = log_2\left(\frac{f_{max}}{f_{min}}\right)
\tag{1}\]</span></span></p>
<p>For a given center frequency <span class="math inline">\(f\)</span> and a desired spectral bandwidth <span class="math inline">\(bw\)</span>, <span class="math inline">\(f_{min}\)</span> and <span class="math inline">\(f_{max}\)</span> can then be derived as follows:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Auxiliary calculations <span class="math display">\[
f = \frac{f_{min} + f_{max}}{2} \rightarrow f_{min} = 2f-f_{max}
\]</span></p>
<p><span class="math display">\[
bw = log_2\left(\frac{f_{max}}{2f-f_{max}}\right)
\]</span></p>
</div>
</div>
<p><span id="eq-2"><span class="math display">\[
f_{min} = \frac{2f}{2^{bw} + 1}
\tag{2}\]</span></span></p>
<p><span id="eq-3"><span class="math display">\[
f_{max} = \frac{2f}{2^{-bw} + 1}
\tag{3}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Alternatively, one could use a geometric mean definition (implemented in our package but our default is the arithmetic mean)</p>
<p><span class="math inline">\(f = \sqrt{f_{min}f_{max}} \rightarrow f_{max} = \frac{f^2}{f_{min}}\)</span></p>
<p><span class="math inline">\(bw = log_2(\frac{f^2}{{f_{min}}^2}) = 2log_2(\frac{f}{f_{min}})\)</span></p>
<p><span class="math inline">\(f_{min} = 2^{-bw/2}\)</span></p>
<p><span class="math inline">\(f_{max} = 2^{bw/2}\)</span></p>
</div>
</div>
<p>Using the relationship between the standard deviation and the FWHM (full width at half maximum) for a normal distribution, we find:</p>
<p><span id="eq-4"><span class="math display">\[
FWHM = f_{max}-f_{min} = 2\sqrt{2ln(2)}\sigma_f
\tag{4}\]</span></span></p>
<p><span id="eq-5"><span class="math display">\[
\sigma_f = \frac{f_{max}-f_{min}}{2\sqrt{2ln(2)}}
\tag{5}\]</span></span></p>
<p>With the uncertainty principle we can derive <span class="math inline">\(\sigma_t\)</span> <span id="eq-6"><span class="math display">\[
\sigma_t = \frac{1}{2\pi\sigma_f} = \frac{\sqrt{2ln(2)}}{\pi\left(\frac{2f}{2^{-bw} + 1}-\frac{2f}{2^{bw} + 1}\right)}
\tag{6}\]</span></span></p>
<p>The Morlet wavelet for center frequency <span class="math inline">\(f\)</span> and spectral smoothing <span class="math inline">\(bw\)</span> is then (A is a normalization constant):</p>
<p><span id="eq-7"><span class="math display">\[
W(t|f,\sigma_t(bw)) = A e^{-\left(\frac{t}{2\sigma_t}\right)^2}e^{i2\pi f t}
\tag{7}\]</span></span></p>
<p>The convolution kernel that implements a Morlet wavelet has finite length. The length can be expressed in multiples of the temporal standard deviation of the Gaussian taper <span class="math inline">\(\sigma_t\)</span>. In our implementation this is the parameter <em>kernel_width</em> with the default value <em>5</em>, corresponding to an extend of the Gaussian taper of <span class="math inline">\(\pm 2.5 \times \sigma_t\)</span>.</p>
<section id="selection-of-a-grid-of-center-frequencies-for-spectral-analyses" class="level4">
<h4 class="anchored" data-anchor-id="selection-of-a-grid-of-center-frequencies-for-spectral-analyses">Selection of a grid of center frequencies for spectral analyses</h4>
<p>Our Morlet wavelet package implements a grid with center frequencies spaced logarithmically according to the exponentiation of the base 2 with exponents ranging from <span class="math inline">\(f_{min}\)</span> (e.g.&nbsp;1 Hz, exponent 0) to <span class="math inline">\(f_{max}\)</span> (e.g.&nbsp;32 Hz, exponent 5) in steps <span class="math inline">\(delta\)</span> (e.g.&nbsp;1/8 oct). This ensures a coverage of frequencies that is <em>coordinated</em> with the spectral bandwidth and ensures a homogeneous coverage in the logarithmic frequency space.</p>
</section>
<section id="relationship-between-the-bandwidth-in-octaves-and-the-characteristic-morlet-wavelet-parameter-q" class="level4">
<h4 class="anchored" data-anchor-id="relationship-between-the-bandwidth-in-octaves-and-the-characteristic-morlet-wavelet-parameter-q">Relationship between the bandwidth in octaves and the characteristic Morlet wavelet parameter <span class="math inline">\(q\)</span></h4>
<p>A common way to parameterize Morlet wavelets is the characteristic parameter <span class="math inline">\(q\)</span> <span class="citation" data-cites="tallon1996stimulus oostenveld2011fieldtrip">(<a href="#ref-tallon1996stimulus" role="doc-biblioref">Tallon-Baudry et al. 1996</a>; <a href="#ref-oostenveld2011fieldtrip" role="doc-biblioref">Oostenveld et al. 2011</a>)</span>. See also, <a href="https://mne.tools/stable/auto_tutorials/time-freq/20_sensors_time_frequency.html#sphx-glr-auto-tutorials-time-freq-20-sensors-time-frequency-py">MNE-Python examples</a>.</p>
<p><span id="eq-8"><span class="math display">\[
q=f/\sigma_f
\tag{8}\]</span></span></p>
<p>From <a href="#eq-6" class="quarto-xref">Equation&nbsp;6</a> and <a href="#eq-8" class="quarto-xref">Equation&nbsp;8</a> follows:</p>
<p><span id="eq-9"><span class="math display">\[
q=\frac{\sqrt{2ln(2)} 2 f}{\left(\frac{2f}{2^{-bw} + 1}-\frac{2f}{2^{bw} + 1}\right)}
\tag{9}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Auxiliary calculation <span class="math display">\[
\frac{2f}{2^{-bw} + 1}-\frac{2f}{2^{bw} + 1}=\frac{2f\left(2^{bw}-2^{-bw}\right)}{2^{bw}+2^{-bw}+2}
\]</span></p>
</div>
</div>
<p><span id="eq-10"><span class="math display">\[
q=\frac{2^{bw}+2^{-bw}+2}{2^{bw}-2^{-bw}} \sqrt{2ln(2)}
\tag{10}\]</span></span></p>
<p>Applied, to our defaults of <span class="math inline">\(bw=0.5\)</span>, using the arithmetic mean, we find <span class="math inline">\(q=6.9\)</span>, which is close to the <span class="math inline">\(q=7\)</span> that is used in literature <span class="citation" data-cites="tallon1996stimulus">(<a href="#ref-tallon1996stimulus" role="doc-biblioref">Tallon-Baudry et al. 1996</a>)</span>.</p>
<div id="e65f41e0" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bw2q(bw):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> np.sqrt(<span class="dv">2</span><span class="op">*</span>np.log(<span class="dv">2</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span> <span class="op">**</span> bw <span class="op">+</span> <span class="dv">2</span> <span class="op">**</span> <span class="op">-</span> bw <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">**</span> bw <span class="op">-</span> <span class="dv">2</span> <span class="op">**</span> <span class="op">-</span> bw) <span class="op">*</span> L</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>bw <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> bw2q(bw)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"q(bw=</span><span class="sc">{</span>bw<span class="sc">:0.2f}</span><span class="ss">) = </span><span class="sc">{</span>q<span class="sc">:0.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>q(bw=0.50) = 6.86</code></pre>
</div>
</div>
<p>With this we can also compute the bandwidth <span class="math inline">\(bw\)</span> from a given <span class="math inline">\(q\)</span> by inverting <a href="#eq-10" class="quarto-xref">Equation&nbsp;10</a>:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Auxiliary calculations</p>
<p><span class="math display">\[
Def: \lambda=\sqrt{2 ln(2)}
\]</span></p>
<p><span class="math display">\[
2^{bw} \lambda + 2^{-bw} \lambda + 2 \lambda -q 2^{bw} + q 2^{-bw} = 0
\]</span></p>
<p><span class="math display">\[
2^{bw}(\lambda - q)+2^{-bw}(\lambda + q) + 2\lambda=0
\]</span></p>
<p><span class="math display">\[
\left(2^{bw}\right)^2+\frac{\lambda+q}{\lambda-q}+2\frac{\lambda}{\lambda - q} 2^{bw}=0
\]</span></p>
<p><span class="math display">\[
\left(2^{bw}+\frac{\lambda}{\lambda-q}\right)^2=\frac{\lambda^2}{(\lambda - q)^2}-\frac{\lambda+q}{\lambda-q}
\]</span></p>
</div>
</div>
<p><span id="eq-11"><span class="math display">\[
bw = log_2\left( \pm\sqrt{\frac{\lambda^2}{(\lambda-q)^2}-\frac{\lambda+q}{\lambda-q}} - \frac{\lambda}{\lambda-q} \right)
\tag{11}\]</span></span></p>
<div id="65c1c702" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> q2bw(q):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> np.sqrt(<span class="dv">2</span><span class="op">*</span>np.log(<span class="dv">2</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.log2(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        np.sqrt((L <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> (L <span class="op">-</span> q) <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> (L <span class="op">+</span> q) <span class="op">/</span> (L <span class="op">-</span> q)) <span class="op">-</span> L <span class="op">/</span> (L <span class="op">-</span> q)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">6.86</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>bw <span class="op">=</span> q2bw(q)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"bw(q=</span><span class="sc">{</span>q<span class="sc">:0.2f}</span><span class="ss">) = </span><span class="sc">{</span>bw<span class="sc">:0.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>bw(q=6.86) = 0.50</code></pre>
</div>
</div>
<p>This allows us to plot the following relationship between our bandwidth the the classical <span class="math inline">\(q\)</span> parameter (see <a href="#fig-q-bw" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div id="cell-fig-q-bw" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> np.linspace(<span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">1000</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bw <span class="op">=</span> q2bw(q)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plt.plot(q, bw, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r"Morlet wavelet parameter $q=f/\sigma_f$"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Bandwidth bw [oct]"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(bw2q(<span class="fl">0.5</span>), color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-q-bw" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_background_wavelets_files/figure-html/fig-q-bw-output-1.png" width="589" height="431" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Relationship between characteristic Morlet-wavelet parameter and bandwidth in octaves. Black lines indicate the mapping from our default bandwidth to <span class="math inline">\(q\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gabor1946theory" class="csl-entry" role="listitem">
Gabor, Dennis. 1946. <span>âTheory of Communication. Part 1: The Analysis of Information.â</span> <em>Journal of the Institution of Electrical Engineers-Part III: Radio and Communication Engineering</em> 93 (26): 429â41.
</div>
<div id="ref-hipp2012large" class="csl-entry" role="listitem">
Hipp, Joerg F, David J Hawellek, Maurizio Corbetta, Markus Siegel, and Andreas K Engel. 2012. <span>âLarge-Scale Cortical Correlation Structure of Spontaneous Oscillatory Activity.â</span> <em>Nature Neuroscience</em> 15 (6): 884â90.
</div>
<div id="ref-morlet_wave_1982" class="csl-entry" role="listitem">
Morlet, J., G. Arens, E. Fourgeau, and D. Giard. 1982. <span>âWave Propagation and Sampling Theoryâ<span>Part</span> <span>II</span>: <span>Sampling</span> Theory and Complex Waves.â</span> <em>GEOPHYSICS</em> 47 (2): 222â36. <a href="https://doi.org/10.1190/1.1441329">https://doi.org/10.1190/1.1441329</a>.
</div>
<div id="ref-oostenveld2011fieldtrip" class="csl-entry" role="listitem">
Oostenveld, Robert, Pascal Fries, Eric Maris, and Jan-Mathijs Schoffelen. 2011. <span>âFieldTrip: Open Source Software for Advanced Analysis of MEG, EEG, and Invasive Electrophysiological Data.â</span> <em>Computational Intelligence and Neuroscience</em> 2011: 1â9.
</div>
<div id="ref-tallon1996stimulus" class="csl-entry" role="listitem">
Tallon-Baudry, Catherine, Olivier Bertrand, Claude Delpuech, and Jacques Pernier. 1996. <span>âStimulus Specificity of Phase-Locked and Non-Phase-Locked 40 Hz Visual Responses in Human.â</span> <em>Journal of Neuroscience</em> 16 (13): 4240â49.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Roche/neuro-meeglet/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>