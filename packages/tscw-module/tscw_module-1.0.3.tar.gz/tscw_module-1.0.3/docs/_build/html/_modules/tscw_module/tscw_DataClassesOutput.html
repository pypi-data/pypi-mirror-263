<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tscw_module.tscw_DataClassesOutput &mdash; Dokumentation tscw_module  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Dokumentation tscw_module
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/Einleitung.html">Übersicht</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/Input.html">TSCW - INPUT - Erstellung</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/Output_Raw.html">TSCW - OUTPUT - Plots und Daten Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/Bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">tscw_module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Dokumentation tscw_module</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tscw_module.tscw_DataClassesOutput</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tscw_module.tscw_DataClassesOutput</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">mplcursors</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">.helper_func</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>

<span class="c1"># FFMPEG Path for video export</span>
<span class="n">ffmpeg_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ffmpeg_essentials\bin\ffmpeg.exe&quot;</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animation.ffmpeg_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">ffmpeg_path</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TSCW_Output</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Super class for TSWC Output. Other instances are inheritances of it. Must not be called!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define meta data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">width</span>  <span class="o">=</span> <span class="mi">406</span> <span class="o">/</span> <span class="mf">25.4</span> <span class="c1"># inches</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mi">229</span> <span class="o">/</span> <span class="mf">25.4</span> <span class="c1"># inches</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>          <span class="c1"># font size</span>
            <span class="s1">&#39;lw&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>           <span class="c1"># line width</span>
            <span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="s1">&#39;arial&#39;</span><span class="p">,</span> <span class="c1"># font style</span>
            <span class="s1">&#39;subtitle_scale&#39;</span> <span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="c1"># scaling for subtitle in plots</span>
            <span class="s1">&#39;width&#39;</span>  <span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="c1"># inches</span>
            <span class="s1">&#39;height&#39;</span> <span class="p">:</span> <span class="n">height</span><span class="p">,</span> <span class="c1"># inches</span>
            <span class="s1">&#39;dpi&#39;</span>    <span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1536</span><span class="o">/</span><span class="n">width</span><span class="p">,</span> <span class="mi">864</span><span class="o">/</span><span class="n">height</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">item</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;family&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;size&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">]}</span>


    <span class="k">def</span> <span class="nf">create_data_array2plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_plot_points</span><span class="p">,</span> <span class="n">all_data</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts data to plot. Must no be called by user (for intern purposes)</span>

<span class="sd">        :param all_plot_points: which depths to plot [depth_t, depth_p] </span>
<span class="sd">        :type all_plot_points: list</span>
<span class="sd">        :param all_data: [self.vertT_df,self.vertP_df] temperature and pressure data</span>
<span class="sd">        :type all_data: list</span>
<span class="sd">        :param mode: either &#39;depth&#39; or &#39;time&#39;, defaults to &#39;time&#39;</span>
<span class="sd">        :type mode: str, optional</span>
<span class="sd">        :return: _description_</span>
<span class="sd">        :rtype: _type_</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">data</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">n_data_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">]):</span>
            <span class="n">plot_points</span> <span class="o">=</span> <span class="n">all_plot_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="c1"># [depth_t, depth_p] </span>
            <span class="n">data_temp</span>   <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>        <span class="c1"># either time or depth</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_points</span><span class="p">):</span>
                <span class="k">match</span> <span class="n">mode</span><span class="p">:</span>
                    <span class="k">case</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
                        <span class="n">key_depth</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    
                        <span class="n">data</span><span class="p">[</span><span class="n">n_data_counter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span>
                            <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">data_temp</span><span class="p">[</span><span class="n">key_depth</span><span class="p">],</span>
                            <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">m - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="p">),</span>
                            <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                            <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="kc">None</span>
                        <span class="p">}</span>

                    <span class="k">case</span> <span class="s1">&#39;depth&#39;</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>

                        <span class="n">data</span><span class="p">[</span><span class="n">n_data_counter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span>
                            <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">,</span>
                            <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">h - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="p">),</span>
                            <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                            <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="kc">None</span>
                        <span class="p">}</span>

                <span class="n">n_data_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">create_pT_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;creates a temperture - pressure plot against time or depth.</span>

<span class="sd">        :param data: output from create_data_array2plot</span>
<span class="sd">        :type data: </span>
<span class="sd">        :param meta: containing information for meta data in plot</span>
<span class="sd">        :type meta: dict</span>
<span class="sd">        :return: _description_</span>
<span class="sd">        :rtype: _type_</span>
<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">constrained_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">match</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
                <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;depth&#39;</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sub_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">match</span> <span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]:</span>
                <span class="k">case</span> <span class="s1">&#39;temp&#39;</span><span class="p">:</span>
                    <span class="n">ln</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">linestyle</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                            <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>
                <span class="k">case</span> <span class="s1">&#39;pressure&#39;</span><span class="p">:</span>
                    <span class="n">ln</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">linestyle</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">sub_data</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                            <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>
            
            <span class="n">lines</span> <span class="o">+=</span> <span class="n">ln</span>

        <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>   
        <span class="n">ax1</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;subtitle&#39;</span><span class="p">],</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;subtitle_scale&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>

                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature [°C]&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure [MPa]&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">i_stage</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">i_stage</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Stage </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> 
                                <span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>

            <span class="k">case</span> <span class="s1">&#39;depth&#39;</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature [°C]&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pressure [MPa]&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;outside center right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;subtitle_scale&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">],</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Cursor</span>
        <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">hover</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;is_export&#39;</span><span class="p">]:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;suffix&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
            <span class="n">i</span>    <span class="o">=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">save_path</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">save_path</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">while</span> <span class="n">save_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">save_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully exported </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
        

    <span class="k">def</span> <span class="nf">calculate_axial_forces_super</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">t_vector</span><span class="p">,</span> <span class="n">p_vector</span><span class="p">,</span> <span class="n">t_total</span><span class="p">,</span>
                                     <span class="n">t_etappe</span><span class="p">,</span> <span class="n">T0</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;  Berechnet Axialkraft bezogen auf Ansatz BB122 aus dem Jahr 2011.</span>
<span class="sd">        Daten und Formeln aus berechnungenbbg_rev2.xlsx.</span>

<span class="sd">        :param meta_data: _description_</span>
<span class="sd">        :type meta_data: _type_</span>
<span class="sd">        :param t_vector: temperature  in [K]</span>
<span class="sd">        :type t_vector: [1 x n] array</span>
<span class="sd">        :param p_vector: pressure in [MPa]</span>
<span class="sd">        :type p_vector: [1 x n] array</span>
<span class="sd">        :param t_total: total time  in [h]</span>
<span class="sd">        :type t_total: [1 x n] array</span>
<span class="sd">        :param t_etappe: stage time  in [h]</span>
<span class="sd">        :type t_etappe: [1 x n] array</span>
<span class="sd">        :param T0: temperature for reference in delta_t [optional - float], else T = t_total[0] </span>
<span class="sd">        :type T0: float, optional</span>
<span class="sd">        :param export_dir: absolute file path to export results, needs to end with &#39;.xlsx&#39; , defaults to None</span>
<span class="sd">        :type export_dir: str, optional</span>
<span class="sd">        :return: pandas dataframe containing forces</span>
<span class="sd">        :rtype: pd.Dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>       

        <span class="n">df</span> <span class="o">=</span> <span class="n">calculate_forces</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">t_vector</span><span class="p">,</span> <span class="n">p_vector</span><span class="p">,</span> <span class="n">t_total</span><span class="p">,</span> <span class="n">t_etappe</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>


    <span class="k">def</span> <span class="nf">show_termination_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_export</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows line where the termination criteria is fullfilled in self.df.</span>

<span class="sd">        :param is_export: exports result as xlsx file into file folder, defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        :return: array containing rows indices of last time step in each stage</span>
<span class="sd">        :rtype: pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>       

        <span class="n">end_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i_stage</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">STAGE</span><span class="p">):</span>
            <span class="n">end_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="n">i_stage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">termination_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">end_indices</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">termination_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_export</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;AbbruckKriterium.xlsx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">termination_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exported </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">end_indices</span>
    
    <span class="k">def</span> <span class="nf">export_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exports self.df to an xlsx file in parent folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;_export.xlsx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exported </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
        


<span class="c1">####################################################################################</span>

<div class="viewcode-block" id="TSCW_TBHC">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC">[docs]</a>
<span class="k">class</span> <span class="nc">TSCW_TBHC</span><span class="p">(</span><span class="n">TSCW_Output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;    Reads data from Projektname_i_pTBHC.txt</span>
<span class="sd">    Important attributes:</span>
<span class="sd">    self.sr_df: - meta data</span>
<span class="sd">    self.vertT_df: - temperature data</span>
<span class="sd">    self.vertP_df: - pressure data</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="n">fid</span>  <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
        <span class="n">idx</span>  <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;***&#39;</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\t*\*\*\*\t*\s*|\s*\t\*\*\*\s*|\t\s*&#39;</span><span class="p">,</span>
                         <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span> 

        <span class="c1"># lines2drop = [0,1,2]            # drop the first three lines due to the three asterics *** in txt file, TODO: read it in as fid open to also read the first three lines.</span>
        <span class="c1"># df = df.drop(lines2drop)</span>
        <span class="c1"># df = df.reset_index(drop=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Succesfully loaded </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;0.00&#39;</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;0.00.1&#39;</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;0.0&#39;</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">]</span>  <span class="c1"># zwei gleiche Schlüssel</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">vertT_df</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">data_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">vertT_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[:</span><span class="n">idx_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>


        <span class="n">vertT_df</span>    <span class="o">=</span> <span class="n">vertT_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vertT_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">data_column</span><span class="p">)})</span> <span class="c1"># give same column names to T and p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span> <span class="o">=</span> <span class="n">vertT_df</span>

        <span class="n">vertP_df</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="n">vertP_df</span>    <span class="o">=</span> <span class="n">vertP_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vertP_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">data_column</span><span class="p">)})</span> <span class="c1"># give same column names to T and p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span> <span class="o">=</span> <span class="n">vertP_df</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_column</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;t_TOTAL&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_etappe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;t_STAGE&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stage_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="o">.</span><span class="n">STAGE</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="TSCW_TBHC.plot_cavern_pt_development">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_cavern_pt_development">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_cavern_pt_development</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_export</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots cavern pressure - temperature development over time.</span>

<span class="sd">        :param is_export: defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span>
                    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;T_CAVERN&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;T_CAVERN&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;red&#39;</span>
                <span class="p">}</span>

        <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span>
                    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;T_WH&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;T_WH&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;orange&#39;</span>
                <span class="p">}</span>

        <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span>
                    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;p_CAVERN&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;p_CAVERN&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;red&#39;</span>
                <span class="p">}</span>

        <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span>
                    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="p">[</span><span class="s1">&#39;p_WH&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;p_WH&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dtype&#39;</span> <span class="p">:</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;orange&#39;</span>
                <span class="p">}</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cavern p-T Distribution&#39;</span><span class="p">,</span>
            <span class="s1">&#39;subtitle&#39;</span> <span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
            <span class="s1">&#39;is_export&#39;</span><span class="p">:</span> <span class="n">is_export</span><span class="p">,</span>
            <span class="s1">&#39;suffix&#39;</span><span class="p">:</span> <span class="s1">&#39;pt_cav_development&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_pT_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span></div>


<div class="viewcode-block" id="TSCW_TBHC.plot_tp_vs_time">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_tp_vs_time">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_tp_vs_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">depth_t</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">depth_p</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_export</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        :param depth_t:  which depth intervals for Temperature, by default all</span>
<span class="sd">        :type depth_t: _type_, optional</span>
<span class="sd">        :param depth_p: _description_, defaults to None</span>
<span class="sd">        :type depth_p: which depth intervals for Pressure, by default all</span>
<span class="sd">        :param is_export: defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="k">if</span> <span class="n">depth_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depth_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span>
        
        <span class="k">if</span> <span class="n">depth_p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depth_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span>

        <span class="n">all_plot_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">depth_t</span><span class="p">,</span> <span class="n">depth_p</span><span class="p">]</span>
        <span class="n">all_data</span>        <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_array2plot</span><span class="p">(</span><span class="n">all_plot_points</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span>       <span class="p">:</span> <span class="s1">&#39;p-T Distribution&#39;</span><span class="p">,</span>
            <span class="s1">&#39;subtitle&#39;</span>    <span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
            <span class="s1">&#39;is_export&#39;</span>   <span class="p">:</span> <span class="n">is_export</span><span class="p">,</span>
            <span class="s1">&#39;suffix&#39;</span>      <span class="p">:</span> <span class="s1">&#39;tp_vs_time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xlabel&#39;</span>      <span class="p">:</span> <span class="s1">&#39;time&#39;</span>
        <span class="p">}</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_pT_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="TSCW_TBHC.plot_tp_vs_depth">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_tp_vs_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_tp_vs_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time_t</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">time_p</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_export</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots borehole temperature - pressure development over depth.</span>

<span class="sd">        :param depth_t: which time intervals for Temperature, by default all</span>
<span class="sd">        :type depth_t: _type_, optional</span>
<span class="sd">        :param depth_p: which time intervals for Pressure, by default all</span>
<span class="sd">        :type depth_p: _type_, optional</span>
<span class="sd">        :param is_export: defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="k">if</span> <span class="n">time_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span>
        
        <span class="k">if</span> <span class="n">time_p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span>

        <span class="n">all_plot_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_t</span><span class="p">,</span> <span class="n">time_p</span><span class="p">]</span>
        <span class="n">all_data</span>        <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_array2plot</span><span class="p">(</span><span class="n">all_plot_points</span><span class="p">,</span> <span class="n">all_data</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">)</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;p-T Distribution&#39;</span><span class="p">,</span>
            <span class="s1">&#39;subtitle&#39;</span> <span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
            <span class="s1">&#39;is_export&#39;</span>   <span class="p">:</span> <span class="n">is_export</span><span class="p">,</span>
            <span class="s1">&#39;suffix&#39;</span><span class="p">:</span> <span class="s1">&#39;tp_vs_depth&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xlabel&#39;</span>   <span class="p">:</span> <span class="s1">&#39;depth&#39;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_pT_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span></div>


<div class="viewcode-block" id="TSCW_TBHC.export_csv">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.export_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Exports data to a xlsx- file.</span>

<span class="sd">        :param depths:  which depths to export (alogrithm looks for closest match)</span>
<span class="sd">        :type depths: list</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">depth_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
            <span class="n">depth_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">,</span><span class="n">depth</span><span class="p">)])</span>


        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_export.xlsx&#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t_TOTAL [h]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;t_Etappe [h]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;T_(z = </span><span class="si">%.2f</span><span class="s1">m) [deg]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">depth_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;p_(z = </span><span class="si">%.2f</span><span class="s1">m) [MPa]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">depth_keys</span><span class="p">]</span> 
        
        <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="o">.</span><span class="n">t_TOTAL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="o">.</span><span class="n">t_STAGE</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depth_keys</span><span class="p">:</span>
            <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">data_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">depth</span><span class="p">)]))</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depth_keys</span><span class="p">:</span>
            <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">data_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">depth</span><span class="p">)]))</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Succesfully exported Regtherm data to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">new_path</span><span class="p">))</span></div>


<div class="viewcode-block" id="TSCW_TBHC.calculate_axial_forces">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.calculate_axial_forces">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_axial_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">z_ref</span><span class="p">,</span> <span class="n">T0</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_export</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates resulting axial forces</span>

<span class="sd">        :param meta_data:  dictionary containing meta data.</span>
<span class="sd">        :type meta_data: dict</span>
<span class="sd">        :param z_ref: reference depth, temperature and pressure array will be calculated by the mean at z_ref and z0 = 0m.</span>
<span class="sd">        :type z_ref: _type_</span>
<span class="sd">        :param T0:  Initial temperature for reference in delta_T, if None it will be the first element of the temperature array.</span>
<span class="sd">        :type T0: float, optional</span>
<span class="sd">        :param is_export: _description_, defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        :return: pandas dataframe containing forces</span>
<span class="sd">        :rtype: pd.Dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
 
        <span class="n">i_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span> <span class="o">&lt;</span> <span class="n">z_ref</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">i_z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span> <span class="o">&gt;=</span> <span class="n">z_ref</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">z0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">i_z0</span><span class="p">]</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">i_z1</span><span class="p">]</span>

        <span class="n">t_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)</span>
        <span class="n">p_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_vector</span><span class="p">)</span>

        <span class="c1"># for i_time in range(len(self.t_total)):</span>
        <span class="c1">#     f_t = interpolate.interp1d([z0, z1],</span>
        <span class="c1">#                                 [self.vertT_df[&#39;%.2f&#39;%(z0)].iloc[i_time],</span>
        <span class="c1">#                                 self.vertT_df[&#39;%.2f&#39;%(z1)].iloc[i_time]]) </span>

        <span class="c1">#     f_p = interpolate.interp1d([z0, z1],</span>
        <span class="c1">#                             [self.vertP_df[&#39;%.2f&#39;%(z0)].iloc[i_time],</span>
        <span class="c1">#                             self.vertP_df[&#39;%.2f&#39;%(z1)].iloc[i_time]]) </span>

            <span class="c1"># t_vector[i_time] = f_t(z_ref)</span>
            <span class="c1"># p_vector[i_time] = f_p(z_ref)</span>

        <span class="c1">#TODO: Take mean temperature between z_ref and 0</span>
        <span class="n">z_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">,</span> <span class="n">z_ref</span><span class="p">)]</span>

        <span class="n">t_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">z_ref</span><span class="p">)]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">p_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">z_ref</span><span class="p">)]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">T0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">t_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_export</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">export_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;_forces.xlsx&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">export_dir</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_axial_forces_super</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">t_vector</span><span class="p">,</span> <span class="n">p_vector</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="o">.</span><span class="n">t_STAGE</span><span class="p">,</span>
                                          <span class="n">T0</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span> <span class="o">=</span> <span class="n">df</span>

        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="TSCW_TBHC.extract_max_force">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.extract_max_force">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_max_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_etappe</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">min_time</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extracts min or max Fz_ges for a selected Stage.</span>

<span class="sd">        :param i_etappe: Stage number</span>
<span class="sd">        :type i_etappe: int</span>
<span class="sd">        :param mode: either &#39;min&#39; or &#39;max&#39;</span>
<span class="sd">        :type mode: str</span>
<span class="sd">        :param min_time: float - minimum time that has passed after the value is selected, put in +inf to select end of stage, 0 by default, defaults to 0</span>
<span class="sd">        :type min_time: float, optional</span>
<span class="sd">        :return: pd.Dataframe containing relevant parameters, respective index in self.df</span>
<span class="sd">        :rtype: _type_</span>
<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="s1">&#39;Rechtschreibfehler!&#39;</span>

        <span class="n">filtered_df</span><span class="p">,</span> <span class="n">df_index</span> <span class="o">=</span> <span class="n">filter_forces_fd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_df</span><span class="o">.</span><span class="n">STAGE</span><span class="p">,</span> <span class="n">i_etappe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">min_time</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_df</span><span class="p">,</span> <span class="n">df_index</span></div>



<div class="viewcode-block" id="TSCW_TBHC.plot_axial_forces">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_axial_forces">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_axial_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_export</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots axial forces of forces_df.</span>

<span class="sd">        :param is_export: Export as png, defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        :rtype: figure</span>
<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_forces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">is_export</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

    
<div class="viewcode-block" id="TSCW_TBHC.plot_forces_difference">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_forces_difference">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_forces_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot difference between calculated forces. Pass other TSWC_TBHC instances as input (comma separated).</span>
<span class="sd">        :param args: Other instances of TSWC_TBHC.</span>
<span class="sd">        :rtype: figure</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fz_ges&#39;</span><span class="p">,</span><span class="s1">&#39;Fz_t (Temperatur)&#39;</span><span class="p">,</span><span class="s1">&#39;Fz_p (Ballooning)&#39;</span><span class="p">]</span>
        <span class="n">forces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fz_ges&#39;</span><span class="p">,</span><span class="s1">&#39;Fz_t&#39;</span><span class="p">,</span><span class="s1">&#39;Fz_p&#39;</span><span class="p">]</span>

        <span class="n">Fz</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forces</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)))</span>
        <span class="n">Fz_difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">):</span>
                <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_ges</span>
                <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_t</span>
                <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i_force</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forces</span><span class="p">)):</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">forces_df</span><span class="p">[</span><span class="n">forces</span><span class="p">[</span><span class="n">i_force</span><span class="p">]],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                    <span class="n">interpolated_force</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)</span>
                    <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">i_force</span><span class="p">,:]</span>  <span class="o">=</span> <span class="n">interpolated_force</span>

            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_ges</span> <span class="o">-</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_t</span> <span class="o">-</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="o">.</span><span class="n">Fz_p</span> <span class="o">-</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">,:])</span>

        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Fz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="p">[</span><span class="s1">&#39;Fz_ges&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="p">[</span><span class="s1">&#39;Fz_t&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces_df</span><span class="p">[</span><span class="s1">&#39;Fz_p&#39;</span><span class="p">]])[</span><span class="kc">None</span><span class="p">,:,:]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span>  <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Fz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx_arg</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
                 <span class="n">temp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">])</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Fz_ges&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Fz_t&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">2</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Fz_p&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_path</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx_arg</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                 <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">Fz_difference</span><span class="p">[</span><span class="n">idx_arg</span><span class="p">,</span><span class="mi">2</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>   
            <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;outside upper center&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;[kN]&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Axial Forces&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time [h]&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;[kN]&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Absolute Difference&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="TSCW_TBHC.plot_pt_difference">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TBHC.plot_pt_difference">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_pt_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        
        <span class="n">depths_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
            <span class="n">depths_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">[</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_array</span><span class="p">,</span> <span class="n">depth</span><span class="p">)]))</span>

        <span class="n">pT_data</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">depths_keys</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)))</span>
        <span class="n">pT_data_difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pT_data</span><span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">):</span>
                <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">[</span><span class="n">depths_keys</span><span class="p">]</span>
                <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">[</span><span class="n">depths_keys</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">depths_keys</span><span class="p">):</span>
                    <span class="n">f_t</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">[</span><span class="n">depth</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                    <span class="n">f_p</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">[</span><span class="n">depth</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>

                    <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)</span>
                    <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">f_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">)</span>

            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">pT_data_difference</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertT_df</span><span class="p">[</span><span class="n">depths_keys</span><span class="p">]</span> 
            <span class="n">pT_data_difference</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pT_data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertP_df</span><span class="p">[</span><span class="n">depths_keys</span><span class="p">]</span> </div>
</div>


<span class="c1">####################################################################################</span>

<div class="viewcode-block" id="TSCW_TFBH">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TFBH">[docs]</a>
<span class="k">class</span> <span class="nc">TSCW_TFBH</span><span class="p">(</span><span class="n">TSCW_Output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads data from /*_TFBH.TXT (Radial temperature along depth in borehole).</span>
<span class="sd">    Stores data in</span>
<span class="sd">    self.data: - data</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">data</span>      <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s*\t\s*&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span>   <span class="o">=</span> <span class="n">data</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;0.0&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>  <span class="c1"># zwei gleiche Schlüssel</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Depth</span><span class="p">)</span>

        <span class="n">data_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[:</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_column</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


<div class="viewcode-block" id="TSCW_TFBH.plot_temp_distribution">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TFBH.plot_temp_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_temp_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">depths</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">range_radial</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_colormap</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">n_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="n">is_export</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The values given in all input lists do not need to match exactly with the simulation result.</span>
<span class="sd">        The algorithm automatically finds the nearest neighbor.</span>

<span class="sd">        :param times: which time points </span>
<span class="sd">        :type times: list</span>
<span class="sd">        :param depths:  which depth points, defaults to None</span>
<span class="sd">        :type depths: list, optional</span>
<span class="sd">        :param range_radial:  [x0, x1] beginning and end of radial range, defaults to None</span>
<span class="sd">        :type range_radial: list, optional</span>
<span class="sd">        :param is_colormap: plot as a colormap or line plot, defaults to True</span>
<span class="sd">        :type is_colormap: bool, optional</span>
<span class="sd">        :param n_levels: how many levels in pcolormesh plot, defaults to 150</span>
<span class="sd">        :type n_levels: int, optional</span>
<span class="sd">        :param is_export: export figure into parent folder of file, defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        :rtype: figure</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        <span class="c1"># Find total time indices to plot</span>
        <span class="n">indices_t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">indices_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>

        <span class="c1"># Find depths to plot </span>
        <span class="k">if</span> <span class="n">depths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices_d</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                <span class="n">indices_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>

        <span class="c1"># Find respective depth indices to plot</span>
        <span class="n">indices_depth</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx_t</span> <span class="ow">in</span> <span class="n">indices_t</span><span class="p">:</span>
            <span class="n">tf_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">idx_t</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">idx_d</span> <span class="ow">in</span> <span class="n">indices_d</span><span class="p">:</span>
                <span class="n">tf_depth</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Depth</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="n">idx_d</span><span class="p">])</span>
                <span class="n">tf_depth</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf_d</span> <span class="ow">and</span> <span class="n">tf_t</span> <span class="k">for</span> <span class="n">tf_d</span><span class="p">,</span> <span class="n">tf_t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tf_time</span><span class="p">,</span> <span class="n">tf_depth</span><span class="p">)]</span>
                <span class="n">tf_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tf_depth</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># should be a scalar</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">indices_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tf_depth</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">indices_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tf_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indices_depth</span><span class="p">,</span> <span class="p">:]</span> <span class="c1">#+ 273.15   # convert °C -&gt; K</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indices_depth</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># print(data)</span>
        <span class="c1"># print(meta)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>

        <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_colormap</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">constrained_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i_time</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">indices_t</span><span class="p">):</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">i_time</span><span class="p">]]</span>
                <span class="n">cur_stage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">STAGE</span><span class="p">[</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">i_time</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c1"># mit contourf</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">)</span>  
                <span class="c1"># extent both limits to start and end of borehole</span>
                <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># delta_z /2 </span>
                <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">temp_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:]</span> 
                <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
                <span class="n">cm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">)</span>

                <span class="c1"># mit pcolormesh</span>
                <span class="c1"># cm = ax.pcolormesh(self.radial_vector, self.depth_vector, temp_data.iloc[:,:] ,</span>
                <span class="c1">#                    shading=&#39;gouraud&#39;, cmap = &#39;jet&#39;, vmin = min_val, vmax = max_val)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%.2f</span><span class="s1">h (Ett. </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">i_time</span><span class="p">],</span> <span class="n">cur_stage</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [m]&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">range_radial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">range_radial</span><span class="p">)</span>
                <span class="c1"># ax.set_ylim([0, self.depth_vector[-1] + self.depth_vector[0]])</span>

            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;z [m]&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#, format = &#39;%.1f K&#39;, label = &#39;Temperature&#39;)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;T [°C]&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_d</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i_depth</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
                <span class="n">temp_depth</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Depth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_depth</span><span class="p">]</span>
                <span class="n">temp_data</span>  <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">meta</span><span class="o">.</span><span class="n">Depth</span> <span class="o">==</span> <span class="n">temp_depth</span><span class="p">]</span>
                <span class="n">temp_meta</span>  <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">meta</span><span class="o">.</span><span class="n">Depth</span> <span class="o">==</span> <span class="n">temp_depth</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)):</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span><span class="p">,</span> <span class="n">temp_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_row</span><span class="p">,:],</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1"> h (Stage </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_meta</span><span class="o">.</span><span class="n">t_TOTAL</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_row</span><span class="p">],</span> <span class="n">temp_meta</span><span class="o">.</span><span class="n">STAGE</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_row</span><span class="p">])</span> <span class="k">if</span> <span class="n">i_depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>         <span class="c1"># only save legend for first entry</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;z = </span><span class="si">%.2f</span><span class="s1"> m&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_depth</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>   
                    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;[°C]&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">range_radial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">range_radial</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;outside center right&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x [m]&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>


        <span class="k">if</span> <span class="n">is_export</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_colormap</span><span class="p">:</span>
                <span class="n">figName</span> <span class="o">=</span> <span class="s1">&#39;colormap&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figName</span> <span class="o">=</span> <span class="s1">&#39;radial&#39;</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">figName</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
            <span class="n">i</span>    <span class="o">=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">save_path</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">save_path</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">while</span> <span class="n">save_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">save_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exported </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span></div>

    

<div class="viewcode-block" id="TSCW_TFBH.create_movie">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TFBH.create_movie">[docs]</a>
    <span class="k">def</span> <span class="nf">create_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_radial</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">is_export</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                     <span class="n">field_data_picklePath</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a time lapse of the simulated temperature.</span>

<span class="sd">        :param range_radial: [x0, x1] range of radial start and end point (no exact match needed), defaults to None</span>
<span class="sd">        :type range_radial: list, optional</span>
<span class="sd">        :param is_export: export movie as .mp4 into the same folder of current instance, defaults to False</span>
<span class="sd">        :type is_export: bool, optional</span>
<span class="sd">        :param n_levels: how many levels for plt.contourf, defaults to 150</span>
<span class="sd">        :type n_levels: int, optional</span>
<span class="sd">        :param field_data_picklePath: path to (/*.pickle) of FieldData class (if it has been exported). If loaded, the geometry will be displayed in the background., defaults to None</span>
<span class="sd">        :type field_data_picklePath: str, optional</span>
<span class="sd">        :return: animation</span>
<span class="sd">        :rtype: animation.FuncAnimation</span>
<span class="sd">        &quot;&quot;&quot;</span>        <span class="c1"># Find radial indices to plot</span>

        <span class="n">font</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="s1">&#39;arial&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;size&#39;</span> <span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>

        <span class="n">n_depths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">)</span>

        <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_depths</span> <span class="p">,:]</span> 
        <span class="n">im_ratio</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">cax</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width_ratios&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.02</span><span class="o">*</span><span class="n">im_ratio</span><span class="p">]},</span> <span class="n">constrained_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">delta_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">is_antialiased</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">field_data_picklePath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">field_data_picklePath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">field_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">alpha</span>      <span class="o">=</span> <span class="mf">0.6</span>
                    <span class="n">x_geom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">field_data</span><span class="o">.</span><span class="n">radial_vector_borehole</span><span class="p">)</span>
                    <span class="n">y_geom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">field_data</span><span class="o">.</span><span class="n">bottom_edge_vertical</span><span class="p">)</span> <span class="o">-</span> <span class="n">field_data</span><span class="o">.</span><span class="n">delta_z</span>
                    <span class="n">y_geom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_data</span><span class="o">.</span><span class="n">bottom_edge_vertical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">X_geom</span><span class="p">,</span><span class="n">Y_geom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x_geom</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">y_geom</span><span class="p">)</span>
                    <span class="n">Z_geom</span>     <span class="o">=</span> <span class="n">field_data</span><span class="o">.</span><span class="n">heat_capacity</span>
                    <span class="n">Z_geom</span>     <span class="o">=</span> <span class="n">Z_geom</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X_geom</span><span class="p">,</span> <span class="n">Y_geom</span><span class="p">,</span> <span class="n">Z_geom</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;binary&#39;</span><span class="p">)</span>
                    <span class="n">delta_z</span> <span class="o">=</span> <span class="n">field_data</span><span class="o">.</span><span class="n">delta_z</span>
                    <span class="n">is_antialiased</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to load </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">field_data_picklePath</span><span class="p">))</span>

        <span class="c1"># x,y = np.copy(self.radial_vector), np.copy(self.depth_vector)  + delta_z /2 # ORIGINAL</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">contour_gid</span> <span class="o">=</span> <span class="s1">&#39;contourf&#39;</span>
        <span class="n">cm</span>      <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span>
                              <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">set_gid</span><span class="p">(</span><span class="n">gid</span><span class="o">=</span><span class="n">contour_gid</span><span class="p">)</span>     
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x [m]&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y [m]&#39;</span><span class="p">,</span> <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">range_radial</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">range_radial</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="c1">#, ylim = [y[0], y[-1]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">animationUpdate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">findobj</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_gid</span><span class="p">()</span> <span class="o">==</span> <span class="n">contour_gid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">Z</span>   	        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">n_depths</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n_depths</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),:]</span>
            <span class="n">cm</span>              <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">n_levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span>
                                       <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_val</span><span class="p">,</span>
                                       <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="n">is_antialiased</span><span class="p">)</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">set_gid</span><span class="p">(</span><span class="n">gid</span><span class="o">=</span><span class="n">contour_gid</span><span class="p">)</span>
            <span class="n">temp_time</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span><span class="p">[</span><span class="n">n_depths</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n_depths</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">temp_stage</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">STAGE</span><span class="p">[</span><span class="n">n_depths</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n_depths</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time: </span><span class="si">%.3f</span><span class="s1">h (Stage </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temp_time</span><span class="p">,</span> <span class="n">temp_stage</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">cm</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animationUpdate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_depths</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">),</span>
                                <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">min_val</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_val</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;T [°C]&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_export</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;.mp4&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">ani</span><span class="o">.</span><span class="n">save_count</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">export_progress</span><span class="p">(</span><span class="n">current_frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">total_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">writervideo</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">writervideo</span><span class="p">,</span> <span class="n">progress_callback</span> <span class="o">=</span>  <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">export_progress</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ani</span></div>
</div>


<div class="viewcode-block" id="TSCW_TFC">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TFC">[docs]</a>
<span class="k">class</span> <span class="nc">TSCW_TFC</span><span class="p">(</span><span class="n">TSCW_Output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads data from /*_TFC.TXT (cavern temperature over time)</span>
<span class="sd">    Stores data in</span>
<span class="sd">    self.data: - data</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">data</span>      <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s*\t\s*&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span>   <span class="o">=</span> <span class="n">data</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;0.0&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>  <span class="c1"># zwei gleiche Schlüssel</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">t_TOTAL</span><span class="p">)</span>

        <span class="n">data_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[:</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_column</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<div class="viewcode-block" id="TSCW_TFC.plot_temp_distribution">
<a class="viewcode-back" href="../../tscw_module.html#tscw_module.tscw_DataClassesOutput.TSCW_TFC.plot_temp_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_temp_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">range_radial</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_export</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot radial temperature development in cavern over time.</span>

<span class="sd">        :param times: which time points </span>
<span class="sd">        :type times: list</span>
<span class="sd">        :param range_radial:  [x0, x1] beginning and end of radial range, defaults to None</span>
<span class="sd">        :type range_radial: list, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="n">times_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">times_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">i_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times_indices</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_time</span><span class="p">,:],</span>
                    <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">h&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_total</span><span class="p">[</span><span class="n">i_time</span><span class="p">]),</span>
                    <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">])</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Cavern temperature development&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)),</span>
                  <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;subtitle_scale&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>   
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;[°C]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;[m]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">range_radial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">range_radial</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;outside center right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;subtitle_scale&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">],</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_export</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;_cavern_temp.png&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_meta</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exported </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">save_path</span><span class="p">))</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, UGS GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>