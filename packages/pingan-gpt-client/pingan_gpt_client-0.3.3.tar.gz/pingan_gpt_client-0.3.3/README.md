# 安装
`pip install pingan-gpt-client`

python版本要求>=3.7

# 如何使用
## 使用样例
```python
from pingan_gpt_client.pingan_gpt import PATechGPTClient

if __name__ == "__main__":
    client = PATechGPTClient(api_credential="CRE00000078",
                             api_private_key="XXX204BD020100300D06092A864886F70D0101010500048204A7308204A3020100028201010093A747C9DA1298CD73EDE35A6DC2406602F237755D4D6CC69C53F950B9283ED7A9B8A27B0907FE2C87BD8D96A84C51AE7AB83ADC6AC8CE9EF4D62B685A88DEF84743AA4B31459BF6EF871906CEE8BAF8B03E054759E19827B12305CA97386A068BAA79F81928662FCAC9DC6F589235FB762CA6E98338A3E4E8DE68427A217C0E32BF2FE1152A498DE1ADC24A48BDEBC2DCC1112968F8C928926F5655F9F9ADFC61692E328B144F25335934BF33C6964051D1216F78CF7644D1B62A6137E35C58F8A0D707E3239B05D1B1FEB43313D07CC4278E62B312A47FF078883FF4CD04ED22B7455FEF236D9D1C1E74CD02EBECE3ECD4DE0EBF3E2F6BF424F00FF06F9ECD02030100010282010003C58C63D22E52EE694571F463A4DDB9C2B356BF7DFE661158641C69D78CF90BFA6C7A640BAF4355765DDD1C7483473BDE812469C5D032D7A477F06716419EF6772039F24E997C04D85F5A558E455624ACF5D748830F2C45E949B47D1569F8C0098DCAD74FA7349DB314FF21EE008575FD5C61CD7464BC3FB2EE1ECF81E8A739F8AD3BA35CF74BA00B11F13FA21E6ADA3B76E2AAD3959D7F83A903E8922602F65BA1047CE2E0631668F02A0F03D21306F0BD7A251397B78C81C167BCB09ABD6A1B277C73E1B69800006938021B4B2F15E2484C83DE8EFFDD8CF6E1574203E914CDAACEFAE71AD2F79FEAA12AC2500696046154F3725660C4C454A97332A95F4902818100CC2783812A582A0E0FCCBF29794B32969B55EECACF41B725E5C157F5FC2E2E40F3F4A96602B0A1AAC0A91DE851D69376457E36739FFADE8C98E30E8EE1AFFF28717C41BA7FACE92C03DD6FDC3E7AA38C4D6E36A7CFDE2B73CBF4A57FDF7B113EBDC994F2FD7776777A680A311E92470E6F32DA6633E5EC3429DF39340EFB03F502818100B926874A2C8D4B9A5F5B70743C47E5C3A5FBB9999A04624FC5D151FEFB11678A32F1BAADF8388F520C3EF46AF720F4A799B2A67E3CFFB1BED3D26F36417097B7B2BFC475BF2484D3B027DC4928AFCCF58E48AC06D386798CAC09B5152DF3E0FE0A416DA4D5FBEE69B61D2A6315E40AEEC4100A4B144291EC80143A3674A7C07902818100B11A522D7A237390314AA846FD4F2BBA9554ADCBC89234A4AEB4D46EB36F0877166B178D44262089358B4043AAC31FB7893F9D531EE48DADA06FD0D0489EDA1626A4E98C357835EB160B421FE91F90C384E4688B997B1D6CDDF104A572A49B6837522961C65A9D2DB6C58C99E1F079ADDEEF59A131C272EF29A7D942FCFFEB0502818060A3A293EDA326660205B931825148B5110ACDBA45B0AA1BD735C565A0685A31C11B7903DAFEB297F1BA5E5B02789A1A6CD7D99D247B95ABF3E5EF94531DD0A2DA52CBD965964B1A2EE4EF4EE444B6672907F77A6CA7D103C2BC225F56A7E7B4D1678B32315A98FB6649DCD8F111213FB4E86666FFC12B675506B9C7B8A5E2890281803FCBEB3D3C374E5202228622F5B02C7E62650D66BD79492A8419D251CFD164209B1FCA5A5ACA8FAAF8B1ED99E051DAB126DB7BBD464CB45FC70AEF129BE4DFEB4A570B27ACE7ED6147333C03A096A8F8915D7156D3ED37265648FD8B9C94FB7C0536DCDF34D70BF5D5CE026E7F0C3A43535645F007EE01A22ADEFFB3AABB3BCA",
                             app_key="XXXcz4fiO8ZF0botLLutqEXdq218uhTR",
                             secret_key="XXXGIO5FYh8ecUh7OMlfrN8MxmACSsEU",
                             scene_id=323
                             )
    # 单条推理
    print(client.pingan_gpt_inference('平安的价值观是什么？'))
    # 批量推理
    print(client.pingan_gpt_batch_inference(["你是什么模型？", "请教我反PUA话术"]))
    # 流式推理
    for chunk in client.pingan_gpt_inference_stream('平安的价值观是什么？'):
        print(chunk)
```

## 关键参数说明
由于需要通过EAGW系统获取访问大模型平台，因此，需要从EAGW系统获取鉴权密钥信息。
### EAGW系统的参数
api credential 和 private key 获取路径：
EAGW系统（ https://eagw-admin.paic.com.cn ） -》开放接口-》凭据管理-》（选择对应的服务）-》凭据编码(api credential) and 密钥管理(private key)

### 大模型平台的参数
app key, secret key, scene id 获取路径：
https://isps-gpt-console-prd-sz.paic.com.cn/ -》大模型服务-》应用接入管理

举例（修改链接里的app_id）: 
https://isps-gpt-console-prd-sz.paic.com.cn/#/modelService/appDetail?id=${APP_ID}


## 推理函数的更多参数
### pingan_gpt_inference
```python
    def pingan_gpt_inference(self, prompt: str,
                             generate_param: Dict[str, Any] = {},
                             session_id: Optional[str] = None,
                             system_instruction: Optional[str] = None,
                             is_use_own_history: Optional[bool] = None,
                             own_history: Optional[List[List[str]]] = None,
                             timeout=120, token: Optional[str] = None,
                             only_answer:bool = False) -> Optional[Union[Dict, str]]:
        """
        :param prompt: 用户输入
        :param generate_param: 模型入参，如{"temperature": 0.7, "top_p": 0.5, "max_new_tokens": 1000}
        :param session_id: 相同sesson_id为同一通对话
        :param system_instruction: 部分大模型如LLAMA支持系统指令
        :param is_use_own_history: 如果为False，则忽略own_history的内容
        :param own_history: 用户自定义的上文历史
        :param timeout: 超时强制返回
        :param token: 如果赋值，可以复用token，否则，每次都会请求一次token，时间慢
        :param only_answer: 直接返回大模型输出的内容，而不是一个Dict类型的网络json
        :return: 
        """
```

### pingan_gpt_batch_inference
基于grequests的异步并发请求。
相比单条请求，仅增加了concurrent参数。（默认为10，最多同时发送10条请求给大模型平台推理）

### pingan_gpt_inference_stream
入参同 pingan_gpt_inference

## 不同环境的访问
该客户端默认访问生产环境，如果需要访问测试环境， 只需要修改EAGW系统的request_token_url和dialog_url参数为测试环境地址即可。

```python
from pingan_gpt_client.pingan_gpt import PATechGPTClient

if __name__ == "__main__":
    client = PATechGPTClient(api_credential="CRE00000078",
                             api_private_key="XXX204BD020100300D06092A864886F70D0101010500048204A7308204A3020100028201010093A747C9DA1298CD73EDE35A6DC2406602F237755D4D6CC69C53F950B9283ED7A9B8A27B0907FE2C87BD8D96A84C51AE7AB83ADC6AC8CE9EF4D62B685A88DEF84743AA4B31459BF6EF871906CEE8BAF8B03E054759E19827B12305CA97386A068BAA79F81928662FCAC9DC6F589235FB762CA6E98338A3E4E8DE68427A217C0E32BF2FE1152A498DE1ADC24A48BDEBC2DCC1112968F8C928926F5655F9F9ADFC61692E328B144F25335934BF33C6964051D1216F78CF7644D1B62A6137E35C58F8A0D707E3239B05D1B1FEB43313D07CC4278E62B312A47FF078883FF4CD04ED22B7455FEF236D9D1C1E74CD02EBECE3ECD4DE0EBF3E2F6BF424F00FF06F9ECD02030100010282010003C58C63D22E52EE694571F463A4DDB9C2B356BF7DFE661158641C69D78CF90BFA6C7A640BAF4355765DDD1C7483473BDE812469C5D032D7A477F06716419EF6772039F24E997C04D85F5A558E455624ACF5D748830F2C45E949B47D1569F8C0098DCAD74FA7349DB314FF21EE008575FD5C61CD7464BC3FB2EE1ECF81E8A739F8AD3BA35CF74BA00B11F13FA21E6ADA3B76E2AAD3959D7F83A903E8922602F65BA1047CE2E0631668F02A0F03D21306F0BD7A251397B78C81C167BCB09ABD6A1B277C73E1B69800006938021B4B2F15E2484C83DE8EFFDD8CF6E1574203E914CDAACEFAE71AD2F79FEAA12AC2500696046154F3725660C4C454A97332A95F4902818100CC2783812A582A0E0FCCBF29794B32969B55EECACF41B725E5C157F5FC2E2E40F3F4A96602B0A1AAC0A91DE851D69376457E36739FFADE8C98E30E8EE1AFFF28717C41BA7FACE92C03DD6FDC3E7AA38C4D6E36A7CFDE2B73CBF4A57FDF7B113EBDC994F2FD7776777A680A311E92470E6F32DA6633E5EC3429DF39340EFB03F502818100B926874A2C8D4B9A5F5B70743C47E5C3A5FBB9999A04624FC5D151FEFB11678A32F1BAADF8388F520C3EF46AF720F4A799B2A67E3CFFB1BED3D26F36417097B7B2BFC475BF2484D3B027DC4928AFCCF58E48AC06D386798CAC09B5152DF3E0FE0A416DA4D5FBEE69B61D2A6315E40AEEC4100A4B144291EC80143A3674A7C07902818100B11A522D7A237390314AA846FD4F2BBA9554ADCBC89234A4AEB4D46EB36F0877166B178D44262089358B4043AAC31FB7893F9D531EE48DADA06FD0D0489EDA1626A4E98C357835EB160B421FE91F90C384E4688B997B1D6CDDF104A572A49B6837522961C65A9D2DB6C58C99E1F079ADDEEF59A131C272EF29A7D942FCFFEB0502818060A3A293EDA326660205B931825148B5110ACDBA45B0AA1BD735C565A0685A31C11B7903DAFEB297F1BA5E5B02789A1A6CD7D99D247B95ABF3E5EF94531DD0A2DA52CBD965964B1A2EE4EF4EE444B6672907F77A6CA7D103C2BC225F56A7E7B4D1678B32315A98FB6649DCD8F111213FB4E86666FFC12B675506B9C7B8A5E2890281803FCBEB3D3C374E5202228622F5B02C7E62650D66BD79492A8419D251CFD164209B1FCA5A5ACA8FAAF8B1ED99E051DAB126DB7BBD464CB45FC70AEF129BE4DFEB4A570B27ACE7ED6147333C03A096A8F8915D7156D3ED37265648FD8B9C94FB7C0536DCDF34D70BF5D5CE026E7F0C3A43535645F007EE01A22ADEFFB3AABB3BCA",
                             app_key="XXXcz4fiO8ZF0botLLutqEXdq218uhTR",
                             secret_key="XXXGIO5FYh8ecUh7OMlfrN8MxmACSsEU",
                             scene_id=323,
                             request_token_url="http://eagw-gateway-sf-stg.paic.com.cn:80/auth/token/apply",
                             dialog_url="http://eagw-gateway-sf-stg.paic.com.cn:80/chatgpt/dialog"
                             )
```

EAGW获取auth token的API：
- prd: "http://eagw-gateway-sf.paic.com.cn:80/auth/token/apply"
- testing: "http://eagw-gateway-sf-stg.paic.com.cn:80/auth/token/apply"

通过EAGW系统调用大模型平台的对话API：
- prd: "http://eagw-gateway-sf.paic.com.cn:80/chatgpt/dialog"
- testing: "http://eagw-gateway-sf-stg.paic.com.cn:80/chatgpt/dialog"
- 
通过EAGW系统调用大模型平台的流式对话API：
- prd: "http://eagw-gateway-sf.paic.com.cn:80/chatgpt/dialog/stream"
- testing: "http://eagw-gateway-sf-stg.paic.com.cn:80/chatgpt/dialog/stream"


# 信息
库的最新版本可以查看官网：
[Pypi地址](https://pypi.org/project/pingan-gpt-client/)

注意：平安内网大概落后Pypi官方源一周时间，如果内网更新不到最新的版本，可以指定官网下载：
0. 切换外网网络
1. `pip3 install -i https://pypi.org/simple pingan-gpt-client --upgrade`

关于库的任何bug或改进，请联系维护者(yanyongwen712)