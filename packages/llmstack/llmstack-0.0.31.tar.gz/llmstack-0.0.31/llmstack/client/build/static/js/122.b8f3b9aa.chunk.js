"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[122],{34122:function(e,n,t){t.r(n),t.d(n,{DataSourceEntries:function(){return oe},default:function(){return se}});var i=t(1413),r=t(93433),a=t(29439),o=t(15411),s=t(21008),l=t(31982),u=t(51073),d=t(79288),c=t(23109),x=t(2146),h=t(45880),f=t(24528),p=t(43630),v=t(73462),Z=t(66161),j=t(20495),y=t(44570),m=t(18221),g=t(10567),S=t(78735),k=t(20888),C=t(34867),b=t(9340),w=t(62154),D=t(71516),_=t(85535),E=t(65173),O=t(31342),A=t(29166),z=t(24578),L=t(8568),N=t(4550),R=t.n(N),M=t(83960),P=t(7276),W=t(9229),T=t(84811),I=t(95142),U=t(6188),B=t(7458),F=t(6334),H=t(84817),V=t(45263);var Y=function(e){var n=e.onCancel,t=e.dataSourceEntry,i=e.open,r=(0,P.useState)(null),o=(0,a.Z)(r,2),s=o[0],l=o[1],u=(0,P.useState)(null),d=(0,a.Z)(u,2),c=d[0],x=d[1],h=(0,P.useState)(!1),f=(0,a.Z)(h,2),p=f[0],j=f[1];return(0,P.useEffect)((function(){var e,n;null!==t&&void 0!==t&&null!==(e=t.config)&&void 0!==e&&e.document_ids?(0,H.o)().get("/api/datasource_entries/".concat(t.uuid,"/text_content")).then((function(e){var n,t;l((0,V.jsx)(I.u,{value:null===(n=e.data)||void 0===n?void 0:n.content,disabled:!0,autoSize:!0,style:{maxHeight:"80vh",width:"100%",overflow:"auto"}})),x(null===(t=e.data)||void 0===t?void 0:t.metadata)})).finally((function(){return j(!1)})):l((0,V.jsx)(I.u,{value:JSON.stringify(null===t||void 0===t||null===(n=t.config)||void 0===n?void 0:n.errors),disabled:!0,autoSize:!0,style:{maxHeight:"80vh",width:"100%",overflow:"auto"}}))}),[t]),(0,V.jsx)(U.ZP,{open:i,onClose:n,anchor:"right",sx:{"& .MuiDrawer-paper":{minWidth:"40%"},maxWidth:"40%"},children:(0,V.jsxs)(Z.Z,{children:[(0,V.jsxs)(B.Z,{direction:"row",gap:1,sx:{mb:"10px",mt:"10px"},children:[(0,V.jsx)(O.Z,{onClick:function(){return n()},sx:{alignSelf:"left"},children:"X"}),Object.keys(c||{}).map((function(e){return(0,V.jsx)(v.Z,{label:"".concat(e,": ").concat(c[e]),size:"small",sx:{borderRadius:"10px",marginTop:"5px"}},e)}))]}),(0,V.jsx)(F.Z,{}),p?(0,V.jsx)(z.Z,{}):(0,V.jsx)("div",{style:{margin:"0px 10px"},children:s})]})})},J=t(54560),G=t(969),K=t(46650),X=t(26235),q=t(49321),Q=t(34160);function $(e){var n=e.id,t=e.open,i=e.onOk,r=e.onCancel,o=e.title,s=e.dataSource,l=P.useState(null===s||void 0===s?void 0:s.visibility),u=(0,a.Z)(l,2),d=u[0],c=u[1];return(0,V.jsxs)(J.Z,{open:t,onClose:function(){return r(n)},"aria-labelledby":"share-datasource-dialog-title","aria-describedby":"share-datasource-dialog-description",children:[(0,V.jsx)(G.Z,{id:"share-datasource-dialog-title",children:o}),(0,V.jsx)(K.Z,{style:{minWidth:"500px"},children:(0,V.jsxs)(B.Z,{spacing:2,children:[(0,V.jsx)("h4",{children:"Choose who can access this datasource"}),(0,V.jsx)(X.Z,{labelId:"share-datasource-select-label",size:"small",defaultValue:void 0===(null===s||void 0===s?void 0:s.visibility)?1:null===s||void 0===s?void 0:s.visibility,onChange:function(e){c(e.target.value)},children:[{value:1,label:"Organization",description:"Members of your organization can access this datasource"},{value:0,label:"You",description:"Only you can access this datasource"}].map((function(e){return(0,V.jsx)(q.Z,{value:e.value,children:(0,V.jsxs)(B.Z,{direction:"row",spacing:1,children:[(0,V.jsx)("span",{children:e.label}),(0,V.jsx)("small",{children:e.description})]})},e.value)}))})]})}),(0,V.jsxs)(Q.Z,{children:[(0,V.jsx)(O.Z,{onClick:function(){return r(n)},children:"Cancel"}),(0,V.jsx)(O.Z,{variant:"contained",onClick:function(){return function(){var e="noop";d!==s.visibility?0===s.visibility&&1===d?(0,H.o)().post("api/org/datasources/".concat(s.uuid,"/add_entry")).then((function(n){i(e,s)})):1===s.visibility&&0===d?(0,H.o)().delete("api/org/datasources/".concat(s.uuid)).then((function(n){i(e,s)})):i(e,s):i(e,s)}()},children:"Done"})]})]})}var ee=t(12283);function ne(e){var n=e.id,t=e.open,i=e.onOk,r=e.onCancel,a=e.title,o=e.text;return(0,V.jsxs)(J.Z,{title:a||"Logged Out",open:t,onCancel:r,children:[(0,V.jsx)(G.Z,{id:"delete-modal-title",children:"Confirm Delete"}),(0,V.jsx)(K.Z,{children:(0,V.jsx)(ee.Z,{children:o})}),(0,V.jsxs)(Q.Z,{children:[(0,V.jsx)(O.Z,{onClick:function(){return r(n)},children:"Cancel"},"cancel"),",",(0,V.jsx)(O.Z,{variant:"contained",type:"primary",onClick:function(){return i(n)},children:"Confirm"},"submit"),","]})]})}function te(e){var n=new Date(e.value);return(0,V.jsx)("span",{children:n.toLocaleString()})}function ie(e){for(var n=e.value,t=["","K","M","G","T","P","E","Z","Y"],i=0;n>=1024;)n/=1024,i+=1;return(0,V.jsx)("span",{children:n>0?n.toFixed(2)+" "+t[i]:n+" "+t[i]})}var re=t(25926),ae=t(46573);function oe(e){var n=e.dataSourceEntryData,t=e.onDatasourceEntryDelete,i=void 0===t?function(){}:t,u=(0,P.useState)(!1),d=(0,a.Z)(u,2),c=d[0],x=d[1],h=(0,P.useState)(null),f=(0,a.Z)(h,2),p=f[0],_=f[1],E=(0,P.useState)(!1),O=(0,a.Z)(E,2),A=O[0],z=O[1],L=(0,P.useState)(new Set),N=(0,a.Z)(L,2),W=N[0],T=N[1],I=(0,ae.lD)(),U=[{title:"Name",key:"name"},{title:"Size",key:"size",render:function(e){return(0,V.jsx)(ie,{value:e})}},{title:"Status",key:"status",render:function(e,n){var t="success";return t="FAILED"===e?"error":"READY"===e?"success":"info",(0,V.jsx)(v.Z,{color:t,style:{cursor:"pointer"},label:n.status.charAt(0)+n.status.slice(1).toLowerCase(),size:"small"},n.uuid)}},{title:"Created At",key:"created_at",render:function(e){return(0,V.jsx)(te,{value:e})}},{title:"Last Modified",key:"updated_at",render:function(e){return R()(e).fromNow()}},{title:"Action",key:"operation",render:function(e,n){var t,i,a,u,d,c,h=("READY"===(null===n||void 0===n?void 0:n.status)||"ERROR"===(null===n||void 0===n?void 0:n.status))&&("file"===(null===n||void 0===n||null===(t=n.datasource)||void 0===t||null===(i=t.type)||void 0===i?void 0:i.name.toLowerCase())||"pdf"===(null===n||void 0===n||null===(a=n.datasource)||void 0===a||null===(u=a.type)||void 0===u?void 0:u.name.toLowerCase())||"url"===(null===n||void 0===n||null===(d=n.datasource)||void 0===d||null===(c=d.type)||void 0===c?void 0:c.name.toLowerCase()));return(0,V.jsxs)(Z.Z,{children:[(0,V.jsx)(j.Z,{title:"View contents",children:(0,V.jsx)(y.Z,{onClick:function(){x(!0),_(n)},disabled:W.has(n.uuid),children:(0,V.jsx)(o.Z,{})})}),h&&(0,V.jsx)(j.Z,{title:"Resync contents",children:(0,V.jsx)(y.Z,{onClick:function(){(0,M.yv)("Resyncing data source entry",{variant:"success"}),T((function(e){return new Set([].concat((0,r.Z)(e),[n.uuid]))})),(0,H.o)().post("/api/datasource_entries/".concat(n.uuid,"/resync")).then((function(e){I()})).catch((function(e){(0,M.yv)("Failed to resync data source entry",{variant:"error"})})).finally((function(){T((function(e){return new Set((0,r.Z)(e).filter((function(e){return e!==n.uuid})))}))}))},children:(0,V.jsx)(s.Z,{})})}),(0,V.jsx)(j.Z,{title:"Delete entry",children:(0,V.jsx)(y.Z,{onClick:function(){_(n),z(!0)},children:(0,V.jsx)(l.Z,{})})})]})}}];return 0===n.length?(0,V.jsx)(m.Z,{children:(0,V.jsxs)(g.Z,{severity:"info",sx:{maxWidth:"300px",margin:"0 auto"},children:[(0,V.jsx)(S.Z,{children:"No entries found"}),"Click on the ",(0,V.jsx)("strong",{children:"+"})," icon to add a new entry."]})}):(0,V.jsxs)(k.Z,{stickyHeader:!0,"aria-label":"sticky table contents",colSpan:7,children:[(0,V.jsx)(C.Z,{children:(0,V.jsx)(b.Z,{children:U.map((function(e){return(0,V.jsx)(w.Z,{sx:{padding:"5px 16px"},children:(0,V.jsx)("strong",{children:e.title})},e.key)}))})}),(0,V.jsx)(D.Z,{sx:{borderBottom:"none"},children:null===n||void 0===n?void 0:n.map((function(e,n){return(0,V.jsx)(b.Z,{role:"checkbox",tabIndex:-1,children:U.map((function(n){var t=e[n.key];return(0,V.jsx)(w.Z,{sx:{padding:"0 16px"},children:n.render?n.render(t,e):t},n.key)}))},e.uuid)}))}),(0,V.jsx)(Y,{onCancel:function(){return x(!1)},dataSourceEntry:p,open:c}),(0,V.jsx)(ne,{id:p,title:"Delete Data Source Entry",text:(0,V.jsxs)("div",{children:["Are you sure you want to delete"," ",(0,V.jsx)("span",{style:{fontWeight:"bold"},children:null===p||void 0===p?void 0:p.name})," ","?"]}),open:A,onOk:function(e){(0,H.o)().delete("/api/datasource_entries/".concat(e.uuid)).then((function(e){i(),I(),z(!1)}))},onCancel:function(){z(!1)}})]})}function se(){var e=(0,P.useState)(1),n=(0,a.Z)(e,2),t=n[0],o=n[1],s=(0,P.useState)(""),v=(0,a.Z)(s,2),m=v[0],g=v[1],S=(0,P.useState)(""),N=(0,a.Z)(S,2),M=N[0],I=N[1],U=(0,P.useState)(null),B=(0,a.Z)(U,2),F=B[0],Y=B[1],J=(0,P.useState)(!1),G=(0,a.Z)(J,2),K=G[0],X=G[1],q=(0,P.useState)(!1),Q=(0,a.Z)(q,2),ee=Q[0],se=Q[1],le=(0,P.useState)(!1),ue=(0,a.Z)(le,2),de=ue[0],ce=ue[1],xe=(0,W.sJ)(re.ye),he=(0,W.FV)(re.MC),fe=(0,a.Z)(he,2),pe=fe[0],ve=fe[1],Ze=(0,W.FV)(re.DK),je=(0,a.Z)(Ze,2),ye=je[0],me=je[1],ge=(0,P.useState)(null),Se=(0,a.Z)(ge,2),ke=Se[0],Ce=Se[1],be=(0,P.useState)([]),we=(0,a.Z)(be,2),De=we[0],_e=we[1],Ee=(0,P.useState)("Add New Data Source"),Oe=(0,a.Z)(Ee,2),Ae=Oe[0],ze=Oe[1],Le=(0,P.useState)(null),Ne=(0,a.Z)(Le,2),Re=Ne[0],Me=Ne[1],Pe=(0,P.useState)(null),We=(0,a.Z)(Pe,2),Te=We[0],Ie=We[1],Ue=(0,ae.lD)(),Be=(0,ae.B6)(),Fe=(0,W.sJ)(re.Dg);(0,P.useEffect)((function(){xe.length>0&&_e((function(e){return xe.map((function(n){var t;return(0,i.Z)((0,i.Z)({},n),{},{expand:(null===(t=e.find((function(e){return e.uuid===n.uuid})))||void 0===t?void 0:t.expand)||!1})}))}))}),[xe]);var He=[{title:"Name",key:"name",render:function(e,n){return(0,V.jsxs)(_.Z,{sx:{display:"flex",fontSize:"0.9rem",fontWeight:n.expand?"600":"inherit",gap:1},children:[n.expand?(0,V.jsx)(u.Z,{fontSize:"10px",sx:{color:"#999",margin:"auto 0"}}):(0,V.jsx)(d.Z,{fontSize:"10px",sx:{color:"#999",margin:"auto 0"}}),e]})}},{title:"Owner",key:"owner_email",render:function(e,n){return(0,V.jsx)("span",{children:n.isUserOwned?"me":n.owner_email})}},{title:"Data Source Type",key:"type",render:function(e){return(0,V.jsx)("span",{children:e.name})}},{title:"Size",key:"size",render:function(e){return(0,V.jsx)(ie,{value:e})}},{title:"Created At",key:"created_at",render:function(e){return(0,V.jsx)(te,{value:e})}},{title:"Last Modified",key:"updated_at",render:function(e){return R()(e).fromNow()}},{title:"Action",key:"operation",render:function(e,n){var t,i,r;return(0,V.jsxs)(Z.Z,{children:[(null===n||void 0===n||null===(t=n.type)||void 0===t?void 0:t.is_external_datasource)&&(0,V.jsx)(j.Z,{title:"Edit entry",children:(0,V.jsx)(y.Z,{disabled:!0,onClick:function(e){ze("Edit Data Source"),X(!0),Me(n),e.stopPropagation()},children:(0,V.jsx)(c.Z,{})})}),!(null!==n&&void 0!==n&&null!==(i=n.type)&&void 0!==i&&i.is_external_datasource)&&(0,V.jsx)(y.Z,{disabled:!n.isUserOwned,onClick:function(e){ze("Add New Data Entry"),Me(n),X(!0),e.stopPropagation()},children:(0,V.jsx)(x.Z,{})}),(null===n||void 0===n||null===(r=n.type)||void 0===r?void 0:r.is_external_datasource)&&(0,V.jsx)(j.Z,{title:"External Connection",children:(0,V.jsx)("span",{children:(0,V.jsx)(y.Z,{disabled:!0,children:(0,V.jsx)(h.Z,{})})})}),(0,V.jsx)(y.Z,{disabled:!n.isUserOwned,onClick:function(){Y(n),g("Delete Data Source"),I((0,V.jsxs)("div",{children:["Are you sure you want to delete"," ",(0,V.jsx)("span",{style:{fontWeight:"bold"},children:n.name})," ?"]})),se(!0)},children:(0,V.jsx)(l.Z,{})}),Fe.IS_ORGANIZATION_MEMBER&&n.isUserOwned&&(0,V.jsx)(y.Z,{onClick:function(){ze("Share Datasource"),Me(n),ce(!0)},children:0===n.visibility?(0,V.jsx)(f.Z,{}):(0,V.jsx)(p.Z,{})})]})}}];return(0,V.jsxs)("div",{id:"data-page",style:{marginBottom:"120px"},children:[(0,V.jsxs)(E.ZP,{span:24,style:{padding:"10px"},children:[(0,V.jsx)(E.ZP,{item:!0,style:{width:"100%",padding:"15px 0px"},children:(0,V.jsx)(O.Z,{onClick:function(){X(!0)},type:"primary",variant:"contained",sx:{float:"left",marginBottom:"10px",textTransform:"none"},children:"Add Data Source"})}),(0,V.jsxs)(E.ZP,{item:!0,style:{width:"100%"},children:[(0,V.jsxs)(k.Z,{stickyHeader:!0,"aria-label":"sticky table",children:[(0,V.jsx)(C.Z,{children:(0,V.jsx)(b.Z,{children:He.map((function(e){return(0,V.jsx)(w.Z,{sx:{paddingLeft:"name"===e.key?"40px":"inherit"},children:(0,V.jsx)("strong",{children:e.title})},e.key)}))})}),(0,V.jsx)(D.Z,{children:De.slice(10*(t-1),10*t).map((function(e,n){return[[(0,V.jsx)(b.Z,{hover:!0,sx:{cursor:"pointer",backgroundColor:e.expand?"#f5f5f5":"inherit"},onClick:function(){!function(e){_e(De.map((function(n){return n.uuid===e.uuid&&(n.expand=!n.expand),n}))),Ce(!0),Ie(e.uuid);var n="/api/datasources/".concat(e.uuid,"/entries");e.isUserOwned||(n="/api/org/datasources/".concat(e.uuid,"/entries")),(0,H.o)().get(n).then((function(n){e.isUserOwned?ve([].concat((0,r.Z)(pe.filter((function(n){return n.datasource.uuid!==e.uuid}))),(0,r.Z)(n.data))):me([].concat((0,r.Z)(ye.filter((function(n){return n.datasource.uuid!==e.uuid}))),(0,r.Z)(n.data)))})).finally((function(){Ce(null)}))}(e)},children:He.map((function(n){var t=e[n.key];return(0,V.jsx)(w.Z,{sx:{fontWeight:e.expand?"bold":"inherit"},children:n.render?n.render(t,e):t},n.key)}))},e.uuid),(0,V.jsx)(b.Z,{children:(0,V.jsx)(w.Z,{colSpan:7,sx:{padding:e.expand?"0":"inherit"},children:(0,V.jsx)(A.Z,{in:e.expand,timeout:"auto",unmountOnExit:!0,children:(0,V.jsx)(Z.Z,{sx:{margin:1},children:ke&&Te===e.uuid?(0,V.jsx)(z.Z,{}):(0,V.jsx)(oe,{dataSourceEntryData:e.data_source_entries||[]})})})})},"".concat(e.uuid,"_details"))]]}))})]}),(0,V.jsx)(L.Z,{count:Math.ceil(De.length/10),variant:"outlined",shape:"rounded",page:t,onChange:function(e,n){o(n)},sx:{marginTop:2,float:"right"}})]})]}),K&&(0,V.jsx)(T.P,{open:K,handleCancelCb:function(){Me(null),X(!1)},dataSourceAddedCb:function(){Me(null),Ue(),Be(),X(!1)},modalTitle:Ae,datasource:Re}),ee&&(0,V.jsx)(ne,{id:F,title:m,text:M,open:ee,onOk:function(e){void 0!==(null===e||void 0===e?void 0:e.data_source_entries)&&(0,H.o)().delete("api/datasources/".concat(e.uuid)).then((function(e){Be(),se(!1)}))},onCancel:function(){se(!1)}}),de&&(0,V.jsx)($,{title:Ae,onCancel:function(){return ce(!1)},onOk:function(){ce(!1)},open:de,dataSource:Re})]})}}}]);