var p=Object.defineProperty;var u=(i,s,e)=>s in i?p(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var c=(i,s,e)=>(u(i,typeof s!="symbol"?s+"":s,e),e);import{i as g,Z as f,F as m,q as F,Y as A}from"./index-6ae5dc18.js";import{a as O,M as v}from"./file-73d14ee4.js";class a extends O{constructor(e,t){super(e!=null&&e.isModel?e.initial:{...e,directories:(e==null?void 0:e.directories)??[],files:(e==null?void 0:e.files)??[]},t);c(this,"_isOpen",!1);c(this,"directories",[]);c(this,"files",[]);c(this,"syncStateOpen");e!=null&&e.isModel?(this.directories=e.directories,this.files=e.files):this.update({files:this.initial.files,directories:this.initial.directories})}get level(){var e;return(((e=this.parent)==null?void 0:e.level)??-1)+1}get isChanged(){return this.name!==this.initial.name||this.files.some(e=>e.isChanged)||this.directories.some(e=>e.isChanged)}get isEmpty(){return this.directories.length===0&&this.files.length===0}get withFiles(){return this.files.length>0}get withDirectories(){return this.directories.length>0}get isNotEmpty(){return this.withFiles||this.withDirectories}get artifacts(){return this.directories.concat(this.files)}get allDirectories(){return this.directories.concat(this.directories.map(e=>e.allDirectories).flat(100))}get allFiles(){return this.files.concat(this.allDirectories.map(e=>e.files).flat(100))}get allVisibleArtifacts(){return this.directories.map(e=>e.isOpened?[e,e.allVisibleArtifacts]:[e]).flat(100).concat(this.isOpened?this.files:[])}get allArtifacts(){return this.directories.map(e=>[e,e.allArtifacts]).flat(100).concat(this.files)}get isOpened(){return this._isOpen}get isClosed(){return g(this._isOpen)}get isModels(){return this.path.startsWith("models")}get isTests(){return this.path.startsWith("tests")}open(){var e;this._isOpen=!0,(e=this.syncStateOpen)==null||e.call(this,this.isOpened)}close(){var e;this._isOpen=!1,(e=this.syncStateOpen)==null||e.call(this,this.isOpened)}toggle(){this.isOpened?this.close():this.open()}expand(){this.open(),this.directories.forEach(e=>{e.expand()})}collapse(){this.close(),this.directories.forEach(e=>{e.collapse()})}containsName(e){return this.artifacts.some(t=>t.name===e)}hasFile(e){return this.allFiles.includes(e)}hasDirectory(e){return this.allDirectories.includes(e)}addFile(e){this.files.push(e),e.parent=this}addDirectory(e){this.directories.push(e),e.parent=this}removeFile(e){this.files=this.files.filter(t=>t!==e)}removeDirectory(e){this.directories=this.directories.filter(t=>t!==e)}update({files:e=[],directories:t=[]}){this.files=[],this.directories=[],t.forEach(r=>{this.addDirectory(new a(r,this))}),e.forEach(r=>{this.addFile(new v(r,this))})}static findArtifactByPath(e,t){return e.path===t?e:e.allArtifacts.find(r=>r.path===t)}static findParentByPath(e,t){const r=e.allDirectories,l=t.split(f).reduce((n,h)=>{if(n.length===0)return[h];if(m(h))return n;const o=n[n.length-1]??"";return n.push(`${o}${f}${h}`),n},[]);for(;l.length>0;){const n=l.pop(),h=r.find(o=>o.path===n);if(F(h))return h}return e}}const w=A((i,s)=>({tests:void 0,project:new a,selectedFile:void 0,files:new Map,activeRange:[],setTests(e){i(()=>({tests:e}))},setActiveRange(e){const t=s();i(()=>({activeRange:t.project.allVisibleArtifacts.filter(r=>d(r,e??t.activeRange))}))},inActiveRange(e){const t=s();return d(e,t.activeRange)},setProject(e){i(()=>({project:e}))},setFiles(e){const t=s();t.files.clear(),i(()=>({files:new Map(e.reduce((r,l)=>r.set(l.id,l),t.files))}))},setSelectedFile(e){i(()=>({selectedFile:e}))},findArtifactByPath(e){const t=s();return a.findArtifactByPath(t.project,e)},findParentByPath(e){const t=s();return a.findParentByPath(t.project,e)},refreshFiles(){const e=s();e.setFiles(e.project.allFiles)}}));function d(i,s){return s.includes(i)}export{a as M,w as u};
