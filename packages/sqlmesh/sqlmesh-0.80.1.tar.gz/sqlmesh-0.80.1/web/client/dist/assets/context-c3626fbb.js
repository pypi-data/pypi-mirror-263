import{r as E,u as z,a as H,j as J,a6 as $,aa as T,s as y,A as R,ab as C,F as Q,q as x,ac as Z,ad as k,i as V,d as ee}from"./index-6ae5dc18.js";import{u as h,M as g}from"./project-81b5f7d4.js";import{M as b,a as te}from"./file-73d14ee4.js";import{u as ie}from"./editor-9a86b9fe.js";const re={Added:1,Modified:2,Deleted:3},j=E.createContext({artifactRename:void 0,setArtifactRename:()=>{},selectArtifactsInRange:()=>new Set,createDirectory:()=>{},createFile:()=>{},renameArtifact:()=>{},removeArtifacts:()=>{},removeArtifactWithConfirmation:()=>{},moveArtifacts:()=>{},isTopGroupInActiveRange:()=>!1,isBottomGroupInActiveRange:()=>!1,isMiddleGroupInActiveRange:()=>!1});function ae({children:G}){const{addError:F}=z(),A=h(e=>e.activeRange),l=h(e=>e.project),M=h(e=>e.files),D=h(e=>e.setActiveRange),_=h(e=>e.setSelectedFile),I=h(e=>e.setFiles),a=h(e=>e.inActiveRange),S=H(e=>e.addConfirmation),f=ie(e=>e.tab),[v,r]=E.useState(!1),[N,L]=E.useState();E.useEffect(()=>{_(f==null?void 0:f.file)},[f==null?void 0:f.id]);function X(e){const n=A.length-1,s=l.allVisibleArtifacts,u=A[0],c=A[n],i=s.indexOf(e),o=u==null?0:s.indexOf(u),d=c==null?n:s.indexOf(c),m=i>o?o:i,p=i>d||i>o&&i<d?i:d;D(s.slice(m,p+1))}function q(e){if(v)return;r(!0);const t=$("new_directory");T(`${e.path}/${t}`,{}).then(n=>{y(n)||e.open()}).catch(n=>F(R.FileExplorer,n)).finally(()=>{r(!1)})}function w(e,t){if(v)return;y(t)&&(e.isModels?t=".sql":e.isTests?t=".yaml":t=".py"),r(!0);const n=$("new_file",t);C(`${e.path}/${n}`,{content:""}).then(s=>{y(s)||e.open()}).catch(s=>F(R.FileExplorer,s)).finally(()=>{r(!1)})}function Y(e,t){var i;t=t==null?void 0:t.trim();const s=(((i=e.parent)==null?void 0:i.artifacts)??[]).some(o=>o.name===t);if(v||Q(t)||s)return;r(!0);const u=e.name,c=e.path;e.rename(t),e instanceof g&&T(c,{new_path:e.path}).catch(o=>{F(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),x(f)&&e.hasFile(f.file)&&_(f.file),I(l.allFiles)}),e instanceof b&&C(c,{new_path:e.path}).then(o=>{e.update(o),M.set(e.path,e),M.delete(c)}).catch(o=>{F(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),I(l.allFiles)})}function P(e){if(v)return;r(!0);const t=e.map(n=>n instanceof b?Z(n.path):k(n.path));Promise.all(t).then(()=>{D([])}).catch(n=>F(R.FileExplorer,n)).finally(()=>{r(!1)})}function B(e){a(e)?S({headline:"Removing Selected Files/Directories",description:`Are you sure you want to remove ${A.length} items?`,yesText:"Yes, Remove",noText:"No, Cancel",details:A.map(t=>t.path),action:()=>{P(A)}}):S({headline:`Removing ${e instanceof g?"Directory":"File"}`,description:`Are you sure you want to remove the ${e instanceof g?"directory":"file"} "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:()=>{x(e.parent)&&P([e])}})}function O(e,t,n=!1){if(v)return;r(!0);const s=[],u=[],c=[];if(e.forEach(i=>{const o=t.containsName(i.name),d=i.path;if(o&&V(n))return c.push(i);n&&i.rename(i.copyName());const m=te.toPath(t.path,i.name);i instanceof g&&(s.push(()=>{var p;(p=i.parent)==null||p.removeDirectory(i),t.addDirectory(i)}),u.push(T(d,{new_path:m})),i.allVisibleArtifacts.forEach(p=>e.splice(e.indexOf(p),1))),i instanceof b&&(s.push(()=>{var p;(p=i.parent)==null||p.removeFile(i),t.addFile(i)}),u.push(C(d,{new_path:m})))}),ee(c)){S({headline:"Moving Duplicates",description:"All duplicated names will be renamed!",yesText:"Yes, Rename",noText:"No, Cancel",details:c.map(i=>i.path),action:()=>{O(e,t,!0)}});return}Promise.all(u).then(i=>{i.forEach((o,d)=>{var m;return(m=s[d])==null?void 0:m.call(s)})}).catch(i=>{console.log(i)}).finally(()=>{r(!1),D([]),I(l.allFiles)})}function W(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return a(e)&&(y(n)||V(a(n)))&&x(s)&&a(s)}function K(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return a(e)&&(y(s)||V(a(s)))&&x(n)&&a(n)}function U(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return a(e)&&x(s)&&a(s)&&x(n)&&a(n)}return J.jsx(j.Provider,{value:{artifactRename:N,setArtifactRename:L,createDirectory:q,createFile:w,renameArtifact:Y,removeArtifacts:P,removeArtifactWithConfirmation:B,moveArtifacts:O,selectArtifactsInRange:X,isTopGroupInActiveRange:W,isBottomGroupInActiveRange:K,isMiddleGroupInActiveRange:U},children:G})}function ce(){return E.useContext(j)}export{re as EnumFileExplorerChange,j as FileExplorerContext,ae as default,ce as useFileExplorer};
