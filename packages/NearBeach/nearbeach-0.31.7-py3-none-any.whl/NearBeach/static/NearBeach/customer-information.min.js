"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[8346],{6073:(e,t,r)=>{r.r(t),r.d(t,{default:()=>L});var s=r(6252),o=r(9963);const a={class:"card"},i={class:"card-body"},l=(0,s._)("h1",null,"Customer Information",-1),n=(0,s._)("br",null,null,-1),u=["href"],c=(0,s._)("hr",null,null,-1),d={class:"row"},m=(0,s._)("div",{class:"col-md-4"},[(0,s._)("strong",null,"Please Note"),(0,s._)("p",{class:"text-instructions"}," Please fill out the following details. If the customer is not assigned an organisation, NearBeach will treat this customer as a freelancer. ")],-1),h={class:"col-md-8"},p={class:"row customer-profile-image"},g=["src"],f=(0,s._)("div",{class:"spacer-extra"},null,-1),_={class:"row"},k={class:"form-group col-sm-3"},v={class:"form-group col-sm-4"},w={class:"form-group col-sm-5"},y=(0,s._)("hr",null,null,-1),Z=(0,s._)("br",null,null,-1),U={key:1},$={key:2,class:"row submit-row"},I={class:"col-md-12"};var S=r(9729),M=r(2001),P=r(4344),N=r(5145),T=r(5705),b=r(760),R=r(7939),C=r(624),x=r(106);const E={name:"CustomerInformation",setup:()=>({v$:(0,T.ZP)()}),components:{NButton:S.ZP,NSelect:M.Z,NUpload:P.Z,StakeholderInformation:N.Z,ValidationRendering:R.Z},props:{customerResults:{type:Array,default:()=>[]},defaultStakeholderImage:{type:String,default:""},organisationResults:{type:Array,default:()=>[]},rootUrl:{type:String,default:"/"},staticUrl:{type:String,default:"/"},theme:{type:String,default:""},titleList:{type:Array,default:()=>[]},userLevel:{type:Number,default:0}},data(){return{customerEmailModel:this.customerResults[0].fields.customer_email,customerFirstNameModel:this.customerResults[0].fields.customer_first_name,customerLastNameModel:this.customerResults[0].fields.customer_last_name,customerTitleModel:this.customerResults[0].fields.customer_title,profilePicture:`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`,titleFixList:[]}},mixins:[C.Z,x.Z],validations:{customerEmailModel:{required:b.C1,email:b.Do},customerFirstNameModel:{required:b.C1},customerLastNameModel:{required:b.C1},customerTitleModel:{required:b.C1}},methods:{showErrorToast(){this.$store.dispatch("newToast",{header:"Error uploading profile picture",message:"Sorry, we had an issue uploading the profile image.",extra_classes:"bg-danger",delay:0})},setProfilePicture(){let e=this.customerResults[0].fields.customer_profile_picture;this.profilePicture=null!=e&&""!==e?`/private${this.rootUrl}${this.customerResults[0].fields.customer_profile_picture}`:`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`},async updateCustomer(){if(!await this.v$.$validate()||this.displayGroupPermissionIssue)return void this.$store.dispatch("newToast",{header:"Please correct issues",message:"Not all fields are correctly validated. Please correct.",extra_classes:"bg-danger"});const e=new FormData;e.set("customer_email",this.customerEmailModel),e.set("customer_first_name",this.customerFirstNameModel),e.set("customer_last_name",this.customerLastNameModel),e.set("customer_title",this.customerTitleModel),this.$store.dispatch("newToast",{header:"Updating Customer",message:"Please wait whilst we update customer",extra_classes:"bg-warning",delay:0,unique_type:"save"}),this.axios.post(`${this.rootUrl}customer_information/${this.customerResults[0].pk}/save/`,e).then((()=>{this.$store.dispatch("newToast",{header:"Customer Updated",message:"The Customer has updated",extra_classes:"bg-success",unique_type:"save"}),this.updateProfilePicture()})).catch((e=>{this.$store.dispatch("newToast",{header:"Failed to Update Customer",message:`Sorry. We have encounted an error. Error -> ${e}`,extra_classes:"bg-danger",delay:0,unique_type:"save"})}))},updateProfilePicture(){this.axios.post(`${this.rootUrl}customer_information/${this.customerResults[0].pk}/get_profile_picture/`,{}).then((e=>{this.profilePicture=e.data})).catch((()=>{this.profilePicture=`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`}))}},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl}),this.titleFixList=this.titleList.map((e=>({value:e.pk,label:e.fields.title}))),this.setProfilePicture()}},L=(0,r(3744).Z)(E,[["render",function(e,t,r,S,M,P){const N=(0,s.up)("n-button"),T=(0,s.up)("n-upload"),b=(0,s.up)("validation-rendering"),R=(0,s.up)("n-select"),C=(0,s.up)("stakeholder-information"),x=(0,s.up)("n-config-provider");return(0,s.wg)(),(0,s.j4)(x,{theme:e.getTheme(r.theme)},{default:(0,s.w5)((()=>[(0,s._)("div",a,[(0,s._)("div",i,[(0,s.kq)(" TITLE "),l,n,(0,s._)("a",{href:`${r.rootUrl}search/customer/`},"Go back to customer search",8,u),c,(0,s.kq)(" FIELDS SECTION "),(0,s._)("div",d,[m,(0,s._)("div",h,[(0,s._)("div",p,[(0,s.kq)(" PROFILE IMAGE "),(0,s._)("img",{src:M.profilePicture,alt:"User Profile Picture",class:"customer-profile-image"},null,8,g),r.userLevel>1?((0,s.wg)(),(0,s.j4)(T,{key:0,action:`${r.rootUrl}customer_information/${r.customerResults[0].pk}/update_profile/`,headers:{"X-CSRFTOKEN":e.getToken("csrftoken")},data:{},onFinish:P.updateProfilePicture,onError:P.showErrorToast},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Update Profile Picture")])),_:1})])),_:1},8,["action","headers","onFinish","onError"])):(0,s.kq)("v-if",!0)]),f,(0,s.kq)(" CUSTOMER INFORMATION "),(0,s._)("div",_,[(0,s._)("div",k,[(0,s._)("label",null,[(0,s.Uk)(" Title: "),(0,s.Wm)(b,{"error-list":S.v$.customerTitleModel.$errors},null,8,["error-list"])]),(0,s.Wm)(R,{options:M.titleFixList,value:M.customerTitleModel,"onUpdate:value":t[0]||(t[0]=e=>M.customerTitleModel=e)},null,8,["options","value"])]),(0,s._)("div",v,[(0,s._)("label",null,[(0,s.Uk)(" First Name: "),(0,s.Wm)(b,{"error-list":S.v$.customerFirstNameModel.$errors},null,8,["error-list"])]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>M.customerFirstNameModel=e)},null,512),[[o.vModelText,M.customerFirstNameModel]])]),(0,s._)("div",w,[(0,s._)("label",null,[(0,s.Uk)(" Last Name: "),(0,s.Wm)(b,{"error-list":S.v$.customerLastNameModel.$errors},null,8,["error-list"])]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>M.customerLastNameModel=e)},null,512),[[o.vModelText,M.customerLastNameModel]])])])])]),(0,s.kq)(" STAKEHOLDER ORGANISATION "),y,r.organisationResults.length>0?((0,s.wg)(),(0,s.j4)(C,{key:0,"organisation-results":r.organisationResults,"default-stakeholder-image":r.defaultStakeholderImage},null,8,["organisation-results","default-stakeholder-image"])):(0,s.kq)("v-if",!0),Z,(0,s.kq)(" NEED TO APPLY PERMISSIONS "),(0,s.kq)(" Submit Button "),r.userLevel>1?((0,s.wg)(),(0,s.iD)("hr",U)):(0,s.kq)("v-if",!0),r.userLevel>1?((0,s.wg)(),(0,s.iD)("div",$,[(0,s._)("div",I,[(0,s._)("a",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:t[3]||(t[3]=(...e)=>P.updateCustomer&&P.updateCustomer(...e))},"Update Customer")])])):(0,s.kq)("v-if",!0)])])])),_:1},8,["theme"])}]])},5145:(e,t,r)=>{r.d(t,{Z:()=>v});var s=r(6252),o=r(3577);const a={class:"row"},i=(0,s._)("div",{class:"col-md-4"},[(0,s._)("h2",null,"Stakeholder")],-1),l={class:"col-md-8 organisation-details"},n=["src"],u={class:"organisation-name"},c=["href"],d={class:"organisation-link"},m=["href"],h={class:"organisation-email"},p=["href"];var g=r(6542),f=r(5808),_=r(989);const k={name:"StakeholderInformation",components:{Icon:g.JO},props:{defaultStakeholderImage:{type:String,default:""},organisationResults:{type:Array,default:()=>[]}},data(){return{stakeholderModel:this.organisationResults[0].fields}},mixins:[f.Z],computed:{...(0,_.Se)({rootUrl:"getRootUrl",staticUrl:"getStaticUrl"}),getStakeholderImage(){const e=this.stakeholderModel.organisation_profile_picture;return""===e||null===e?this.defaultStakeholderImage:`${this.rootUrl}private/${e}`}}},v=(0,r(3744).Z)(k,[["render",function(e,t,r,g,f,_){const k=(0,s.up)("Icon");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.kq)(" Description "),i,(0,s._)("div",l,[(0,s._)("img",{src:_.getStakeholderImage,alt:"Stakeholder Logo",class:"organisation-image"},null,8,n),(0,s._)("div",u,[(0,s._)("a",{href:`${e.rootUrl}organisation_information/${r.organisationResults[0].pk}/`},(0,o.toDisplayString)(f.stakeholderModel.organisation_name),9,c)]),(0,s._)("div",d,[(0,s.Wm)(k,{icon:e.icons.linkOut},null,8,["icon"]),(0,s.Uk)(" Website: "),(0,s._)("a",{href:f.stakeholderModel.organisation_website,target:"_blank",rel:"noopener noreferrer"},(0,o.toDisplayString)(f.stakeholderModel.organisation_website),9,m)]),(0,s._)("div",h,[(0,s.Wm)(k,{icon:e.icons.mailIcon},null,8,["icon"]),(0,s.Uk)(" Email: "),(0,s._)("a",{href:`mailto:${f.stakeholderModel.organisation_email}`},(0,o.toDisplayString)(f.stakeholderModel.organisation_email),9,p)])])])}]])},7939:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(6252),o=r(3577);const a={name:"ValidationRendering",props:{errorList:{type:Array,default:()=>[]}}},i=(0,r(3744).Z)(a,[["render",function(e,t,r,a,i,l){return(0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.errorList,(e=>((0,s.wg)(),(0,s.iD)("span",{class:"error",key:e.$uid},(0,o.toDisplayString)(e.$message),1)))),128)}]])},624:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(7449);const o={data:()=>({darkTheme:s.$}),methods:{getTheme:e=>"dark"===e?s.$:null}}},106:(e,t,r)=>{r.d(t,{Z:()=>s});const s={methods:{getToken(e){const t=new RegExp(`${e}=([^;]+)`).exec(document.cookie);return null!==t?encodeURIComponent(t[1]):null}}}},5808:(e,t,r)=>{r.d(t,{Z:()=>P});var s=r(3985),o=r(5555),a=r(1826),i=r(6443),l=r(1327),n=r(8521),u=r(1056),c=r(4324),d=r(9672),m=r(9867),h=r(1239),p=r(5004),g=r(1321),f=r(1216),_=r(5550),k=r(7702),v=r(7903),w=r(2606),y=r(3843),Z=r(2393),U=r(3360),$=r(9714),I=r(1323),S=r(2610),M=r(5968);const P={data:()=>({icons:{arrowUp:s.Z,bugIcon:o.Z,bxBriefcase:a.Z,cardChecklist:i.Z,clipboardIcon:l.Z,documentPdf:n.Z,documentText:u.Z,folderIcon:c.Z,groupPresentation:d.Z,imageIcon:m.Z,infoCircle:h.Z,linkIcon:p.Z,linkIcon2:g.Z,linkOut:f.Z,mailIcon:_.Z,microsoftExcel:k.Z,microsoftPowerpoint:v.Z,microsoftWord:w.Z,noteAdd:y.Z,objectStorage:Z.Z,passwordIcon:U.Z,trashCan:$.Z,userIcon:I.Z,usersIcon:S.Z,xCircle:M.Z}})}}}]);