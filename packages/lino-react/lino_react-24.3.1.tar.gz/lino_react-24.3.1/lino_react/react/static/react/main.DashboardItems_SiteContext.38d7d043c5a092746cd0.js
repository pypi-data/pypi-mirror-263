"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[4580],{3971:(e,t,s)=>{s.r(t),s.d(t,{DashboardItems:()=>u,name:()=>h});s(5247);var r=s(7881),a=s.n(r),o=s(6606),d=s(1151),n=s(3748);let i;i={queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),AbortController:s.e(4166).then(s.t.bind(s,1181,23)),whatwgFetch:s.e(4166).then(s.bind(s,9853)),prProgressSpinner:Promise.all([s.e(6190),s.e(5573)]).then(s.bind(s,920)),lm:Promise.resolve().then(s.bind(s,8546))};(0,o.RegisterImportPool)(i);class l extends o.Component{constructor(){super(),this.state={...this.state,data:[],loaded:!1,placeholder:"Loading..."},this.reloadData=this.reloadData.bind(this),this.reload=this.reloadData}onReady(){this.controller=new this.ex.AbortController.default,this.reloadData()}componentWillUnmount(){this.controller.abort()}reloadData(){this.setState({loaded:!1});let e={fmt:"json"};window.App.add_su(e),e[d.URL_PARAM_LINO_VERSION]=window.Lino[d.URL_PARAM_LINO_VERSION],e[d.URL_PARAM_USER_LANGUAGE]=window.App.data.selectedLanguage||window.App.state.user_settings.lang,this.ex.whatwgFetch.fetch(this.props.endpoint+`?${this.ex.queryString.default.stringify(e)}`,{signal:this.controller.signal}).then((e=>200!==e.status?(this.setState({placeholder:"Something went wrong"}),{status:e.status$}):e.json())).then((e=>{this.props.post_data(e),this.setState({data:e,loaded:!0,everloaded:!0})})).catch((function(e){"AbortError"===e.name&&console.log("request aborted",e)}))}render(){if(!this.state.ready)return null;const{data:e,loaded:t,placeholder:s,everloaded:r}=this.state,{render:a}=this.props;return r&&!t?(0,n.jsx)(this.ex.lm.LoadingMask,{mask:!0,children:a(e)}):(0,n.jsx)(this.ex.lm.LoadingMask,{mask:!1,children:t||r&&this.props.useEverLoaded?a(e):this.props.hideLoading?(0,n.jsx)("div",{}):(0,n.jsx)(this.ex.prProgressSpinner.ProgressSpinner,{})})}}l.requiredModules=["queryString","AbortController","whatwgFetch","prProgressSpinner","lm"],l.iPool=i,l.propTypes={endpoint:a().string.isRequired,render:a().func.isRequired,post_data:a().func,hideLoading:a().bool,useEverLoaded:a().bool},l.defaultProps={post_data:e=>e,hideLoading:!1,useEverLoaded:!1};const h="DashboardItems";let p;p={prButton:Promise.all([s.e(1927),s.e(5573),s.e(7236),s.e(4600),s.e(7801)]).then(s.bind(s,6286)),lm:Promise.resolve().then(s.bind(s,8546))};(0,o.RegisterImportPool)(p);class u extends o.Component{constructor(){super(),this.state={...this.state,stamp:Date(),unloaded:!0},this.reloadData=this.reload,this.onDataGet=this.onDataGet.bind(this)}reload(){Object.keys(window.App.rps).filter((e=>e.includes("dashboard"))).forEach((e=>{window.App.rps[e].reload()}))}onDataGet(e){this.setState({unloaded:!1})}renderDashboard(e,t){return s=>{if(!s.version_mismatch||"dashboard-0"!==t)return s.html?(0,n.jsxs)("div",{children:[e&&(0,n.jsx)(this.ex.prButton.Button,{icon:"pi pi-refresh",style:{float:"right"},onClick:()=>{let e=window.App.rps[t];e&&e.reload()}}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:s.html}})]}):void 0;window.App.reload()}}render(){if(!this.state.ready)return null;const e=this.state,t=this.props;let s=t.dashboard_items;return void 0===s&&(s=0),(0,n.jsxs)(this.ex.lm.LoadingMask,{mask:e.unloaded,fillHeight:!0,backgroundColor:"",children:[(0,n.jsx)(l,{ref:e=>{window.App.setRpRef(e,"dashboard-main")},endpoint:"api/main_html",useEverLoaded:!0,hideLoading:!0,post_data:this.onDataGet,render:this.renderDashboard(!1,"dashboard-main")},`${t.user}-${e.stamp}`),[...Array(s).keys()].map((s=>(0,n.jsx)(l,{ref:e=>{window.App.setRpRef(e,`dashboard-${s}`)},endpoint:`dashboard/${s}`,post_data:this.onDataGet,hideLoading:!0,render:this.renderDashboard(!0,`dashboard-${s}`)},`${t.user}-${s}-${e.stamp}`)))]})}}u.requiredModules=["prButton","lm"],u.iPool=p,u.propTypes={user:a().string},u.defaultProps={P:0}}}]);
//# sourceMappingURL=main.DashboardItems_SiteContext.38d7d043c5a092746cd0.js.map