{"version":3,"file":"main.DashboardItems_SiteContext.38d7d043c5a092746cd0.js","mappings":"qNAOA,IAAIA,EAA6BA,EAAK,CAClCC,YAAa,wDACbC,gBAAiB,oCACjBC,YAAa,+BACbC,kBAAmB,uDACnBC,GAAI,yCAERC,EAAAA,EAAAA,oBAAmBN,GAGZ,MAAMO,UAAqBC,EAAAA,UAqB9BC,WAAAA,GACIC,QACAC,KAAKC,MAAQ,IACND,KAAKC,MACRC,KAAM,GACNC,QAAQ,EACRC,YAAa,cAEjBJ,KAAKK,WAAaL,KAAKK,WAAWC,KAAKN,MACvCA,KAAKO,OAASP,KAAKK,UACvB,CAEAG,OAAAA,GACIR,KAAKS,WAAa,IAAIT,KAAKX,GAAGE,gBAAgBmB,QAC9CV,KAAKK,YACT,CAEAM,oBAAAA,GACIX,KAAKS,WAAWG,OACpB,CAEAP,UAAAA,GACIL,KAAKa,SAAS,CAACV,QAAQ,IACvB,IAAIW,EAAQ,CAACC,IAAK,QAClBC,OAAOC,IAAIC,OAAOJ,GAClBA,EAAMK,EAAUC,wBAA0BJ,OAAOK,KAAKF,EAAUC,wBAChEN,EAAMK,EAAUG,yBAA2BN,OAAOC,IAAIf,KAAKqB,kBAAoBP,OAAOC,IAAIhB,MAAMuB,cAAcC,KAC9GzB,KAAKX,GAAGG,YAAYkC,MAAM1B,KAAK2B,MAAMC,SAAY,IAAG5B,KAAKX,GAAGC,YAAYoB,QAAQmB,UAAUf,KAAU,CAChGgB,OAAQ9B,KAAKS,WAAWqB,SACvBC,MAAKC,GACsB,MAApBA,EAASC,QACTjC,KAAKa,SAAS,CAACT,YAAa,yBACrB,CAAC6B,OAAOD,EAASE,UAErBF,EAASG,SAEnBJ,MAAK7B,IACFF,KAAK2B,MAAMS,UAAUlC,GACrBF,KAAKa,SAAS,CAACX,KAAMA,EAAMC,QAAQ,EAAMkC,YAAY,GAAM,IAC5DC,OAAM,SAASjD,GACA,eAAZA,EAAGkD,MACLC,QAAQC,IAAI,kBAAmBpD,EAEnC,GACR,CAEAqD,MAAAA,GACI,IAAK1C,KAAKC,MAAM0C,MAAO,OAAO,KAC9B,MAAM,KAACzC,EAAI,OAAEC,EAAM,YAAEC,EAAW,WAAEiC,GAAcrC,KAAKC,OAC/C,OAACyC,GAAU1C,KAAK2B,MAGtB,OAAIU,IAAelC,GAERyC,EAAAA,EAAAA,KAAA,KAAMvD,GAAGK,GAAGmD,YAAW,CAACC,MAAM,EAAKC,SACrCL,EAAOxC,MAIL0C,EAAAA,EAAAA,KAAA,KAAMvD,GAAGK,GAAGmD,YAAW,CAACC,MAAM,EAAMC,SACtC5C,GAAUkC,GAAcrC,KAAK2B,MAAMqB,cAC9BN,EAAOxC,GAAQF,KAAK2B,MAAMsB,aAAcL,EAAAA,EAAAA,KAAA,WAASA,EAAAA,EAAAA,KAAA,KAAMvD,GAAGI,kBAAkByD,gBAAe,KAG7G,EArFStD,EACFuD,gBAAkB,CACrB,cAAe,kBAAmB,cAAe,oBACjD,MAHKvD,EAKFwD,MAAQ/D,EALNO,EAOFyD,UAAY,CACfzB,SAAU0B,IAAAA,OAAiBC,WAC3Bb,OAAQY,IAAAA,KAAeC,WACvBnB,UAAWkB,IAAAA,KACXL,YAAaK,IAAAA,KACbN,cAAeM,IAAAA,MAZV1D,EAeF4D,aAAe,CAClBpB,UAAYlC,GAAUA,EACtB+C,aAAa,EACbD,eAAe,GCnChB,MAAMT,EAAO,iBAQpB,IAAIlD,EAA6BA,EAAK,CAClCoE,SAAU,sFACV/D,GAAI,yCAERC,EAAAA,EAAAA,oBAAmBN,GAGZ,MAAMqE,UAAuB7D,EAAAA,UAWhCC,WAAAA,GACIC,QACAC,KAAKC,MAAQ,IACND,KAAKC,MACR0D,MAAOC,OACPC,UAAU,GAGd7D,KAAKK,WAAaL,KAAKO,OACvBP,KAAK8D,UAAY9D,KAAK8D,UAAUxD,KAAKN,KACzC,CAIAO,MAAAA,GAIIwD,OAAOC,KAAKhD,OAAOC,IAAIgD,KAAKC,QAAOC,GAAKA,EAAEC,SAAS,eAAcC,SAAQC,IACrEtD,OAAOC,IAAIgD,IAAIK,GAAG/D,QAAQ,GAElC,CAEAuD,SAAAA,CAAUQ,GACNtE,KAAKa,SAAS,CACVgD,UAAU,GAElB,CAEAU,eAAAA,CAAgBC,EAAkBC,GAC9B,OAAQvE,IACJ,IAAIA,EAAKwE,kBAA2B,gBAAPD,EAI7B,OAAIvE,EAAKyE,MACEC,EAAAA,EAAAA,MAAA,OAAA7B,SAAA,CACFyB,IAAoB5B,EAAAA,EAAAA,KAAA,KAAMvD,GAAGoE,SAASoB,OAAM,CAACC,KAAM,gBAAiBC,MAAO,CAACC,MAAM,SAAUC,QAASA,KAClG,IAAIC,EAAKlE,OAAOC,IAAIgD,IAAIQ,GACxBS,GAAMA,EAAG3E,QAAQ,KAGrBqC,EAAAA,EAAAA,KAAA,OAAKuC,wBAAyB,CAACC,OAAQlF,EAAKyE,gBAPpD,EAHI3D,OAAOC,IAAIV,QAYf,CAER,CAEAmC,MAAAA,GACI,IAAK1C,KAAKC,MAAM0C,MAAO,OAAO,KAC9B,MAAM0C,EAAIrF,KAAKC,MACTqF,EAAItF,KAAK2B,MACf,IAAI4D,EAAMD,EAAEE,gBAMZ,YALYC,IAARF,IACAA,EAAM,IAIHX,EAAAA,EAAAA,MAAA,KAAMvF,GAAGK,GAAGmD,YAAW,CAACC,KAAMuC,EAAExB,SAAU6B,YAAY,EAAMC,gBAAiB,GAAG5C,SAAA,EACnFH,EAAAA,EAAAA,KAAChD,EAAY,CACTgG,IAAMC,IACF7E,OAAOC,IAAI6E,SAASD,EAAK,iBAAgB,EAG7CjE,SAAU,gBACVoB,eAAe,EACfC,aAAa,EACbb,UAAWpC,KAAK8D,UAChBpB,OAAQ1C,KAAKuE,iBAAgB,EAAQ,mBAL/B,GAAEe,EAAES,QAAQV,EAAE1B,SAOvB,IAAIqC,MAAMT,GAAKvB,QAAQiC,KAAIC,IACxBtD,EAAAA,EAAAA,KAAChD,EAAY,CAETgG,IAAMC,IACF7E,OAAOC,IAAI6E,SAASD,EAAK,aAAYK,IAAI,EAE7CtE,SAAW,aAAYsE,IACvB9D,UAAWpC,KAAK8D,UAChBb,aAAa,EACbP,OAAQ1C,KAAKuE,iBAAgB,EAAO,aAAY2B,MAP1C,GAAEZ,EAAES,QAAQG,KAAKb,EAAE1B,aAWzC,EA9FSD,EACFP,gBAAkB,CAAC,WAAY,MAD7BO,EAEFN,MAAQ/D,EAFNqE,EAGFL,UAAY,CAEf0C,KAAMzC,IAAAA,QALDI,EAOFF,aAAe,CAClB8B,EAAG,E","sources":["webpack://lino_react/./lino_react/react/components/DataProvider.jsx","webpack://lino_react/./lino_react/react/components/DashboardItems.jsx"],"sourcesContent":["export const name = \"DataProvider\";\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport * as constants from './constants';\nimport { RegisterImportPool, Component } from \"./Base\";\n\nlet ex; const exModulePromises = ex = {\n    queryString: import(/* webpackChunkName: \"queryString_DataProvider\" */\"query-string\"),\n    AbortController: import(/* webpackChunkName: \"AbortController_DataProvider\" */\"abort-controller\"),\n    whatwgFetch: import(/* webpackChunkName: \"whatwgFetch_DataProvider\" */\"whatwg-fetch\"),\n    prProgressSpinner: import(/* webpackChunkName: \"prProgressSpinner_DataProvider\" */\"primereact/progressspinner\"),\n    lm: import(/* webpackChunkName: \"LoadingMask_DataProvider\" */\"./LoadingMask\"),\n}\nRegisterImportPool(ex);\n\n\nexport class DataProvider extends Component {\n    static requiredModules = [\n        'queryString', \"AbortController\", \"whatwgFetch\", \"prProgressSpinner\",\n        \"lm\"]\n\n    static iPool = ex;\n\n    static propTypes = {\n        endpoint: PropTypes.string.isRequired,\n        render: PropTypes.func.isRequired,\n        post_data: PropTypes.func,\n        hideLoading: PropTypes.bool,\n        useEverLoaded: PropTypes.bool,\n\n    };\n    static defaultProps = {\n        post_data: (data) => (data),\n        hideLoading: false,\n        useEverLoaded: false,\n    };\n\n    constructor() {\n        super();\n        this.state = {\n            ...this.state,\n            data: [],\n            loaded: false,\n            placeholder: \"Loading...\"\n        };\n        this.reloadData = this.reloadData.bind(this);\n        this.reload = this.reloadData;\n    }\n\n    onReady() {\n        this.controller = new this.ex.AbortController.default();\n        this.reloadData();\n    }\n\n    componentWillUnmount() {\n        this.controller.abort();\n    }\n\n    reloadData() {\n        this.setState({loaded: false});\n        let query = {fmt: \"json\"}\n        window.App.add_su(query);\n        query[constants.URL_PARAM_LINO_VERSION] = window.Lino[constants.URL_PARAM_LINO_VERSION];\n        query[constants.URL_PARAM_USER_LANGUAGE] = window.App.data.selectedLanguage || window.App.state.user_settings.lang;\n        this.ex.whatwgFetch.fetch(this.props.endpoint + `?${this.ex.queryString.default.stringify(query)}`, {\n            signal: this.controller.signal})\n            .then(response => {\n                if (response.status !== 200) {\n                    this.setState({placeholder: \"Something went wrong\"});\n                    return {status:response.status$} //\n                }\n                return response.json();\n            })\n            .then(data => {\n                this.props.post_data(data);\n                this.setState({data: data, loaded: true, everloaded: true});\n            }).catch(function(ex) {\n              if (ex.name === 'AbortError') {\n                console.log('request aborted', ex)\n              }\n            })\n    };\n\n    render() {\n        if (!this.state.ready) return null;\n        const {data, loaded, placeholder, everloaded} = this.state;\n        const {render} = this.props;\n        // const Comp = \"Table\";\n        // return loaded ? this.props.render(data, Comp) : <p>{placeholder}</p>;\n        if (everloaded && !loaded) {\n            // is loading with data, use loading mask\n            return <this.ex.lm.LoadingMask mask={true}>\n                {render(data)}\n            </this.ex.lm.LoadingMask>\n        }\n        else {\n            return <this.ex.lm.LoadingMask mask={false}>\n                {loaded || everloaded && this.props.useEverLoaded\n                    ? render(data) : this.props.hideLoading ? <div/> : <this.ex.prProgressSpinner.ProgressSpinner/>}\n            </this.ex.lm.LoadingMask>\n        }\n    }\n}\n","export const name = \"DashboardItems\";\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { RegisterImportPool, Component } from \"./Base\";\n\nimport { DataProvider } from \"./DataProvider\";\n\nlet ex; const exModulePromises = ex = {\n    prButton: import(/* webpackChunkName: \"prButton_DashboardItems\" */\"primereact/button\"),\n    lm: import(/* webpackChunkName: \"LoadingMask_DashboardItems\" */\"./LoadingMask\"),\n}\nRegisterImportPool(ex);\n\n\nexport class DashboardItems extends Component {\n    static requiredModules = [\"prButton\", \"lm\"];\n    static iPool = ex;\n    static propTypes = {\n        // dashboard_items: PropTypes.number.\n        user: PropTypes.string\n    };\n    static defaultProps = {\n        P: 0\n    };\n\n    constructor() {\n        super();\n        this.state = {\n            ...this.state,\n            stamp: Date(),\n            unloaded: true,\n        };\n        // this.method = this.method.bind(this);\n        this.reloadData = this.reload;\n        this.onDataGet = this.onDataGet.bind(this)\n    }\n\n    // method() {return this.props.}\n\n    reload() {\n        // this.setState({ // Set new stamp forcing reloading of each DP\n        //     stamp:Date()\n        // });\n        Object.keys(window.App.rps).filter(k => k.includes(\"dashboard\")).forEach(d => {\n            window.App.rps[d].reload();\n        })\n    }\n\n    onDataGet(d) {\n        this.setState({\n            unloaded: false\n        })\n    }\n\n    renderDashboard(showReloadButton, rp) {\n        return (data) => {\n            if (data.version_mismatch && rp === \"dashboard-0\") {\n                window.App.reload();\n                return\n            }\n            if (data.html) {\n                return <div>\n                    {showReloadButton && <this.ex.prButton.Button icon={\"pi pi-refresh\"} style={{float:\"right\"}} onClick={() => {\n                        let dp = window.App.rps[rp];\n                        dp && dp.reload();\n                    }\n                    }/>}\n                    <div dangerouslySetInnerHTML={{__html: data.html}}></div>\n                </div>\n            }\n        }\n    }\n\n    render() {\n        if (!this.state.ready) return null;\n        const S = this.state;\n        const P = this.props;\n        let len = P.dashboard_items;\n        if (len === undefined) {\n            len = 0\n        }\n        // const Comp = \"Table\";\n        // return loaded ? this.props.render(data, Comp) : <p>{placeholder}</p>;\n        return <this.ex.lm.LoadingMask mask={S.unloaded} fillHeight={true} backgroundColor={\"\"}>\n            <DataProvider\n                ref={(el) => {\n                    window.App.setRpRef(el, `dashboard-main`)\n                }}\n                key={`${P.user}-${S.stamp}`}\n                endpoint={\"api/main_html\"}\n                useEverLoaded={true}\n                hideLoading={true}\n                post_data={this.onDataGet}\n                render={this.renderDashboard(false, `dashboard-main`)}\n            />\n            {[...Array(len).keys()].map(i =>\n                <DataProvider\n                    key={`${P.user}-${i}-${S.stamp}`}\n                    ref={(el) => {\n                        window.App.setRpRef(el, `dashboard-${i}`)\n                    }}\n                    endpoint={`dashboard/${i}`}\n                    post_data={this.onDataGet}\n                    hideLoading={true}\n                    render={this.renderDashboard(true, `dashboard-${i}`)}\n                />)\n            }\n        </this.ex.lm.LoadingMask>\n    }\n}\n"],"names":["ex","queryString","AbortController","whatwgFetch","prProgressSpinner","lm","RegisterImportPool","DataProvider","Component","constructor","super","this","state","data","loaded","placeholder","reloadData","bind","reload","onReady","controller","default","componentWillUnmount","abort","setState","query","fmt","window","App","add_su","constants","URL_PARAM_LINO_VERSION","Lino","URL_PARAM_USER_LANGUAGE","selectedLanguage","user_settings","lang","fetch","props","endpoint","stringify","signal","then","response","status","status$","json","post_data","everloaded","catch","name","console","log","render","ready","_jsx","LoadingMask","mask","children","useEverLoaded","hideLoading","ProgressSpinner","requiredModules","iPool","propTypes","PropTypes","isRequired","defaultProps","prButton","DashboardItems","stamp","Date","unloaded","onDataGet","Object","keys","rps","filter","k","includes","forEach","d","renderDashboard","showReloadButton","rp","version_mismatch","html","_jsxs","Button","icon","style","float","onClick","dp","dangerouslySetInnerHTML","__html","S","P","len","dashboard_items","undefined","fillHeight","backgroundColor","ref","el","setRpRef","user","Array","map","i"],"sourceRoot":""}