import{d as h,E as f,C as m,o as _,P as g,b as l,c,e as t,F as x,g as b,t as r,Q as y}from"./index-e9cad759.js";const k={class:"w-full h-full items-center justify-center px-6 py-10 scroll-smooth"},w={class:"w-full min-h-screen flex flex-col justify-end"},v={class:"flex-grow text-xs text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-500"},S={class:"px-3 py-1"},j={class:"w-full h-20 p-4 border-none border-gray-300 dark:border-gray-500 justify-center rounded-lg"},B={class:"flex justify-between mb-1"},N={class:"text-base font-medium text-blue-700 dark:text-white"},C={class:"text-sm font-medium text-blue-700 dark:text-white"},E={class:"w-full bg-gray-200 rounded-full h-1.5 dark:bg-gray-700"},M=h({__name:"logs",setup(F){const i=f(),e=m({task:"",ts:"",lines:[],stage:"",epoch:void 0,total:void 0,n:void 0,remain:"",rate:"",postfix:"",progress:""});_(()=>{e.task=i.params.task,e.ts=i.params.ts,console.log("task: "+e.task+", ts: "+e.ts);const a=g().replace(/^https?/,"ws");console.log(a),d()});function d(){const a=g().replace(/^https?/,"ws")+"/task/logs";console.log("connecting to: "+a);const n=new WebSocket(a);n.onopen=o=>{console.log("[ws] connected"),n.send(JSON.stringify({task:e.task,ts:e.ts})),e.lines=[]},n.onerror=o=>{console.log("error: "+o),setTimeout(()=>d(),5e3)},n.onclose=o=>{console.log("[ws] connection closed"),e.n=e.total,e.progress="100%"},n.onmessage=o=>{try{const s=JSON.parse(o.data);if(s.error)console.log("error: "+s.error);else if(s.msg)console.log("msg: "+s.msg);else if("log"in s)e.lines.push(s.log),window.scrollTo({left:0,top:document.body.scrollHeight,behavior:"smooth"});else{e.epoch=s.epoch,e.stage=s.stage,e.n=s.n,e.total=s.total,e.rate=s.rate,e.postfix=s.postfix,e.remain=s.remain;const p=e.n||0,u=e.total||1e-8;e.progress=Math.round(100*p/u)+"%"}}catch(s){console.error(s)}}}return(a,n)=>(l(),c("div",k,[t("div",w,[t("div",v,[(l(!0),c(x,null,b(e.lines,o=>(l(),c("pre",S,r(o),1))),256))])]),t("div",j,[t("div",B,[t("span",N,"[epoch "+r(e.epoch)+"] ("+r(e.stage||"-")+")",1),t("span",C,r(e.n||"-")+"/"+r(e.total||"-")+" | "+r(e.rate)+" | eta: "+r(e.remain||"-"),1)]),t("div",E,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:y({width:e.progress})},null,4)])])]))}});export{M as default};
