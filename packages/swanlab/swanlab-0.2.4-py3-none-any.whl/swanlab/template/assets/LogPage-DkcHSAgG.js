import{_ as e,L as l,i as a,c as t,j as n,h as s,ak as r,o,a as u,g as i,f as c,b as v,n as d,F as g,s as p,e as x,d as f,q as m,t as h,T as y,aj as b,v as w,x as S,ao as k,C as T}from"./index-BwvvGA3s.js";import{_ as j}from"./SLLoading-DSAGk2rM.js";import{F as L}from"./FuncBar-ChkW6WBg.js";const N={class:"w-full h-full px-7 py-6 relative overflow-hidden"},q={key:0},_={key:1,class:"text-negative-default"},H={key:0,class:"w-full py-10 flex flex-col items-center text-lg font-semibold"},C=(e=>(w("data-v-db4ee8fc"),e=e(),S(),e))((()=>v("span",null,"No Logs",-1))),O={key:1,class:"flex h-full items-center justify-center"},F=e({__name:"LogPage",setup(e){const w=l().id,S=a(),F=t((()=>{var e;const l=null==(e=S.value)?void 0:e.map((e=>{const l=isNaN(e.substring(0,e.indexOf(" "))),a=l?null:e.substring(0,e.indexOf(" ")),t=l?e:e.substring(e.indexOf(" ")).trimStart(),n=""!==E.value&&t.toLowerCase().includes(E.value);return{isTarget:n,index:a,value:n?P(t,E.value):t}})),a=I(l);return B.value.map(((e,t)=>l.push({index:a+t+1,value:e,error:!0}))),l})),$=t((()=>{var e;let l=1;const a=null==(e=F.value)?void 0:e.length;return a&&(l=""===F.value[a-1].index?F.value[a-2].index:F.value[a-1].index),l?8*l.length+"px":"0px"})),I=e=>{const l=null==e?void 0:e.reduce(((e,l)=>l.index&&Number(l.index)>Number(e)?l.index:e),0);return Number(l)},M=t((()=>{var e;const l=null==(e=S.value)?void 0:e.map((e=>isNaN(e.substring(0,e.indexOf(" ")))?e:e.substring(e.indexOf(" ")).trimStart()));return(null==l?void 0:l.join("\n"))+B.value.join("\n")})),P=(e,l)=>{let a=e.split(new RegExp(`(${l})`,"i"));return a=a.filter((e=>""!==e)),a},B=a([]),E=a("");a(1);const R=e=>{E.value=e.toLowerCase()};t((()=>F.value.filter((e=>e.isTarget))));const V=a([0,0]),z=a(16),A=t((()=>{var e;return(null==(e=F.value)?void 0:e.length)*z.value})),D=k((e=>{const l=e.target;G(l)}),100),G=e=>{const l=z.value,a=Math.ceil(e.clientHeight/l),t=Math.floor(e.scrollTop/l),n=t+a;e.scrollTop<=30*l?V.value[0]=0:V.value[0]=t-30,e.scrollTop+e.clientHeight>=e.scrollHeight-30*l?V.value[1]=F.value.length-1:V.value[1]=n+30},J=t((()=>V.value[0]*z.value));return n((async()=>{const{data:e}=await s.get(`/experiment/${w}/recent_log`).catch((e=>{3404===e.data.code&&(S.value=[])}));S.value=e.logs||[],e.error&&(B.value=e.error),r((()=>{G(document.querySelector(".log-container")),(()=>{const e=document.querySelector(".log-line");if(!e)return 0;const l=window.getComputedStyle(e);z.value=parseFloat(l.getPropertyValue("line-height"))})(),document.querySelector(".log-container").scrollHeight>document.querySelector(".log-container").clientHeight&&(document.querySelector(".log-container").scrollTop=document.querySelector(".log-container").scrollHeight)}))})),(e,l)=>{const a=T;return o(),u("div",N,[S.value?(o(),i(L,{key:0,class:"pb-6",onInput:R,content:M.value,placeholder:e.$t("experiment.func-bar.placeholder.log"),filename:"print.log"},null,8,["content","placeholder"])):c("",!0),v("section",{class:"log-container",onScroll:l[0]||(l[0]=(...e)=>f(D)&&f(D)(...e))},[S.value?(o(),u("div",{key:0,class:"log-area",style:d({height:A.value+"px"})},[v("div",{class:"log-board",style:d({top:J.value+"px"})},[(o(!0),u(g,null,p(F.value.slice(V.value[0],V.value[1]+1),((e,l)=>(o(),u("div",{class:"log-line",key:e.value+V.value[0]+l},[v("span",{class:m(["w-8 text-right flex-shrink-0 text-dimmest select-none",{"text-negative-default":e.error}]),style:d({width:$.value})},h(e.index),7),e.error?(o(),u("div",_,h(e.value),1)):(o(),u("div",q,[y(v("span",null,h(e.value),513),[[b,!e.isTarget]]),y(v("span",null,[(o(!0),u(g,null,p(e.value,(e=>(o(),u("span",{key:e,class:m({"bg-warning-dimmest":e.toLowerCase()===E.value})},h(e),3)))),128))],512),[[b,e.isTarget]])]))])))),128))],4),0===S.value.length&&0===B.value.length?(o(),u("div",H,[x(a,{class:"magnifier",icon:"search"}),C])):c("",!0)],4)):(o(),u("div",O,[x(j)]))],32)])}}},[["__scopeId","data-v-db4ee8fc"]]);export{F as default};
